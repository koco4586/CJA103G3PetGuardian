<!DOCTYPE html>
<html lang="zh-TW" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>保母收藏 | PetGuardian</title>
    <link rel="stylesheet" th:href="@{/css/frontend/style.css}">
    <link rel="stylesheet" th:href="@{/css/frontend/components.css}">
    <link rel="stylesheet" th:href="@{/css/frontend/dashboard.css}">
    <style>
        /* 針對保母卡片的微調 */
        .sitter-card {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            border: 1px solid #f0f0f0;
            transition: all 0.3s ease;
        }
        .sitter-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.08);
        }
        .sitter-avatar-wrapper {
            height: 160px;
            position: relative;
            background: #f8fafc;
        }
        .sitter-avatar {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .rating-badge {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.9);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            color: #ffb800;
            font-weight: 700;
        }
        .btn-reserve {
            width: 100%;
            padding: 0.6rem;
            background: var(--primary-color);
            color: white;
            border-radius: 10px;
            text-align: center;
            text-decoration: none;
            font-weight: 600;
            display: block;
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <header id="main-header" class="header"></header>

    <div class="container dashboard-container">
        <div th:replace="~{frontend/fragments/dashboard-sidebar :: sidebar(activePage='favorites')}"></div>

        <main class="main-content">
            <h2 class="mb-2">我的收藏</h2>

            <div class="d-flex justify-between align-center mb-2">
                <div class="sub-tabs">
				    <a th:href="@{/booking/memberFavorites}" 
				       class="sub-tab" 
				       th:classappend="${activeTab == 'sitters' ? 'active' : ''}">保母</a>
				
				    <a th:href="@{/favorites/store}" 
				       class="sub-tab" 
				       th:classappend="${activeTab == 'store' ? 'active' : ''}">二手商品</a>
				        <a th:href="@{/favorites/articles}" class="sub-tab">文章</a>
				</div>
                <span style="color: #999;" th:text="'共 ' + ${#lists.size(sitterFavorites)} + ' 位保母'">共 0 位</span>
            </div>

            <div th:if="${#lists.isEmpty(sitterFavorites)}" class="empty-state">
                <i class="fas fa-user-slash"></i>
                <p>還沒有收藏任何保母喔！</p>
                <a href="/booking/services" class="btn btn-primary mt-2">尋找保母</a>
            </div>

            <div class="store-grid" th:if="${!#lists.isEmpty(sitterFavorites)}">
                <div th:each="fav : ${sitterFavorites}" class="sitter-card">
                    <div class="sitter-avatar-wrapper">
                        <a th:href="@{/frontend/public/sitter/detail/{id}(id=${fav.sitterId})}">
                            <img th:src="@{'/api/sitter/' + ${fav.sitterId} + '/image'}" class="sitter-avatar" onerror="this.src='/images/default-sitter.png'">
                        </a>
                        
                        <div class="rating-badge">
                            <i class="fas fa-star"></i> <span th:text="${fav.starRating}">5.0</span>
                        </div>

                        <button class="btn-like active" th:onclick="'removeSitterFav(' + ${fav.sitterId} + ', this)'">
                            <i class="fas fa-heart"></i>
                        </button>
                    </div>

                    <div style="padding: 1.2rem;">
                        <h4 th:text="${fav.sitterName}" style="margin: 0;">保母名稱</h4>
                        <p style="color: #666; font-size: 0.85rem; margin: 0.5rem 0;">
                            <i class="fas fa-location-dot"></i> <span th:text="${fav.sitterAdd}">服務區域</span>
                        </p>
                        
                        <div class="d-flex gap-xs">
                            <span class="category-tag">到府照顧</span>
                            <span class="category-tag">遛狗服務</span>
                        </div>

                        <a th:href="@{/booking/services(sitterId=${fav.sitterId})}" class="btn-reserve">
                            立即預約
                        </a>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // 使用 AJAX 移除收藏，不刷新頁面
        async function removeSitterFav(sitterId, btn) {
            if(!confirm('確定要移除此收藏嗎？')) return;
            
            const response = await fetch(`/favorites/sitters/remove/${sitterId}`, { method: 'POST' });
            if (response.ok) {
                // 找到最外層卡片並移除
                btn.closest('.sitter-card').fadeOut(300, function() { $(this).remove(); });
            }
        }
    </script>
</body>
</html>