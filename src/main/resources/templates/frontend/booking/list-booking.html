<!DOCTYPE html>
<html lang="zh-TW" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>é ç´„æµç¨‹ç¸½è¦½ - Pet Guardian</title>
	<link rel="stylesheet" th:href="@{/css/frontend/style.css}">
	<link rel="stylesheet" th:href="@{/css/frontend/components.css}">
	<link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;700&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
	<style>
		.process-container {
			max-width: 1100px;
			margin: 3rem auto;
			background: white;
			border-radius: 2rem;
			padding: 2.5rem;
			box-shadow: 0 10px 40px rgba(0, 0, 0, 0.04);
			border: 1px solid #f0f0f0;
		}

		.premium-table {
			width: 100%;
			border-collapse: separate;
			border-spacing: 0 0.8rem;
		}

		.premium-table th {
			padding: 1rem;
			color: #71717a;
			font-weight: 600;
			text-align: left;
			border-bottom: 2px solid #f4f4f5;
		}

		.premium-table td {
			background: #fff;
			padding: 1.2rem 1rem;
			border-top: 1px solid #f0f0f0;
			border-bottom: 1px solid #f0f0f0;
		}

		.premium-table td:first-child {
			border-left: 1px solid #f0f0f0;
			border-radius: 1rem 0 0 1rem;
		}

		.premium-table td:last-child {
			border-right: 1px solid #f0f0f0;
			border-radius: 0 1rem 1rem 0;
		}

		.badge {
			padding: 0.4rem 0.8rem;
			border-radius: 0.6rem;
			font-size: 0.8rem;
			font-weight: 600;
		}

		.status-wait {
			background: #fef3c7;
			color: #92400e;
		}

		.status-ongoing {
			background: #dbeafe;
			color: #1e40af;
		}

		.status-ready {
			background: #dcfce7;
			color: #166534;
		}
	</style>
</head>

<body style="background: #fafafa;">
	<header id="main-header" class="header"></header>

	<main class="container">
		<div class="process-container">
			<div class="d-flex justify-between align-center mb-2">
				<h2 style="font-weight: 700; margin: 0;">ğŸ› ï¸ é ç´„æµç¨‹ç›£æ§</h2>
				<div style="color: #999; font-size: 0.9rem;">æª¢è¦–æ‰€æœ‰æœå‹™è«‹æ±‚èˆ‡æ’¥æ¬¾ç‹€æ…‹</div>
			</div>

			<table class="premium-table">
				<thead>
					<tr>
						<th>è¨‚å–®ç·¨è™Ÿ</th>
						<th>å°è±¡ (é£¼ä¸» â†’ ä¿æ¯)</th>
						<th>é ç´„æ—¥æœŸ</th>
						<th>æµç¨‹ç‹€æ…‹</th>
						<th>æœå‹™ç¸½é¡</th>
						<th style="text-align: right;">æ“ä½œ</th>
					</tr>
				</thead>
				<tbody>
					<tr th:each="order : ${allBookings}">
						<td style="font-weight: 600;" th:text="'#BK-' + ${order.bookingOrderId}"></td>
						<td>
							<div class="d-flex align-center gap-xs">
								<span class="badge" style="background: #f1f5f9; color: #475569;"
									th:text="'ID:' + ${order.memId}"></span>
								<i class="fa-solid fa-arrow-right-long text-muted" style="font-size: 0.7rem;"></i>
								<span class="badge" style="background: #f1f5f9; color: #475569;"
									th:text="'ID:' + ${order.sitterId}"></span>
							</div>
						</td>
						<td th:text="${#temporals.format(order.startTime, 'MMæœˆddæ—¥ HH:mm')}"></td>
						<td>
							<span th:if="${order.orderStatus == 0}" class="badge status-wait">å¾…ç¢ºèª</span>
							<span th:if="${order.orderStatus == 1}" class="badge status-ongoing">é€²è¡Œä¸­</span>
							<span th:if="${order.orderStatus == 2}" class="badge status-ready">æœå‹™å®Œæˆ</span>
							<span th:if="${order.orderStatus == 5}" class="badge"
								style="background: #f4f4f5; color: #999;">å·²çµæ¡ˆ</span>
						</td>
						<td style="font-weight: 700; color: var(--primary-color);"
							th:text="'$' + ${#numbers.formatDecimal(order.reservationFee, 0, 'COMMA', 0, 'POINT')}">
						</td>
						<td style="text-align: right;">
					<!--  		<button th:if="${order.orderStatus == 2}" class="btn btn-primary btn-sm"
								style="border-radius: 2rem;"
								th:onclick="'executePayout(' + ${order.bookingOrderId} + ')'">
								åŸ·è¡Œæ’¥æ¬¾
							</button> -->
							<button th:if="${order.orderStatus == 0}" class="btn btn-outline btn-sm"
								style="border-radius: 2rem;">
								æé†’ä¿æ¯
							</button>
						</td>
					</tr>
				</tbody>
			</table>

			<div th:if="${#lists.isEmpty(allBookings)}" style="text-align: center; padding: 4rem 0;">
				<p style="color: #ccc; font-style: italic;">ç›®å‰ç„¡ç›£æ§ä¸­çš„é ç´„è«‹æ±‚</p>
			</div>
		</div>
	</main>

	<script th:src="@{/js/frontend/main.js}"></script>
	<script>
		function executePayout(orderId) {
			if (confirm('ç¢ºå®šè¦å°‡æ¬¾é …æ’¥ä»˜çµ¦ä¿æ¯å—ï¼Ÿ')) {
				fetch(`/admin/bookings/payout?orderId=${orderId}`, { method: 'POST' })
	            .then(res => res.text())
	            .then(data => {
	                if (data === "success") {
	                    alert("æ’¥æ¬¾æˆåŠŸï¼");
	                    location.reload();
	                } else {
	                    alert("æ’¥æ¬¾å¤±æ•—ï¼š" + data);
	                }
	            });
	    	}
		}
	</script>
</body>

</html>