<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>賣家管理中心 | PetGuardian</title>
    <link rel="stylesheet" href="../../static/css/frontend/style.css">
    <link rel="stylesheet" href="../../static/css/frontend/components.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../../static/css/frontend/store.css">
</head>

<body>

    <header id="main-header" class="header"></header>

    <div class="container" style="margin-top: 2rem;">
        <div class="d-flex justify-between align-center mb-2">
            <h2>賣家管理中心</h2>
        </div>

        <div class="d-flex" style="gap: 1.5rem; align-items: flex-start;">
            <!-- Dashboard Sidebar -->
            <div class="seller-sidebar" style="flex: 0 0 250px;">
                <div class="sidebar-profile">
                    <div class="avatar-container">
                        <img src="https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?auto=format&fit=crop&q=80&w=400"
                            class="avatar">
                        <div class="status-badge"><i class="fas fa-crown"></i></div>
                    </div>
                    <h3 class="profile-name">李小明</h3>
                    <p class="profile-role">優選賣家</p>
                </div>

                <nav class="seller-menu">
                    <div class="seller-menu-item active" onclick="showSellerPanel('overview')" id="menu-overview">
                        <i class="fas fa-chart-pie"></i> 營運概況
                    </div>
                    <div class="seller-menu-item" onclick="showSellerPanel('products')" id="menu-products">
                        <i class="fas fa-box-open"></i> 商品管理
                    </div>
                    <div class="seller-menu-item" onclick="showSellerPanel('orders')" id="menu-orders">
                        <i class="fas fa-clipboard-list"></i> 訂單管理
                        <span class="badge badge-error"
                            style="margin-left: auto; font-size: 0.7rem; padding: 2px 6px;">2</span>
                    </div>
                    <a href="store.html" class="seller-menu-item"
                        style="margin-top: 1rem; border-top: 1px solid #eee; padding-top: 1rem;">
                        <i class="fas fa-shopping-bag"></i> 返回商城
                    </a>
                </nav>
            </div>

            <!-- Dashboard Content -->
            <div style="flex: 1;">

                <!-- VIEW: Overview (Default) -->
                <div id="seller-overview-panel">
                    <div class="d-flex gap-md mb-4">
                        <div class="card seller-dashboard-card p-3"
                            style="flex: 1; text-align: center; border-radius: 16px;">
                            <h3 class="mb-1" style="color: var(--primary-color); font-size: 2.2rem; font-weight: 800;">5
                            </h3>
                            <p style="color: #868e96; font-weight:500;">上架中</p>
                        </div>
                        <div class="card seller-dashboard-card p-3"
                            style="flex: 1; text-align: center; border-radius: 16px;">
                            <h3 class="mb-1" style="color: #fa5252; font-size: 2.2rem; font-weight: 800;">2</h3>
                            <p style="color: #868e96; font-weight:500;">待出貨</p>
                        </div>
                        <div class="card seller-dashboard-card p-3"
                            style="flex: 1; text-align: center; border-radius: 16px;">
                            <h3 class="mb-1" style="color: #495057; font-size: 2.2rem; font-weight: 800;">$3,450
                            </h3>
                            <p style="color: #868e96; font-weight:500;">本月收入</p>
                        </div>
                    </div>
                </div>

                <!-- VIEW: Products -->
                <div id="seller-products-panel" style="display: none;">
                    <div class="d-flex justify-between align-center mb-2">
                        <h3 class="mb-0">商品管理</h3>
                        <button class="btn btn-primary btn-sm" onclick="showSellerPanel('add-product')">
                            <i class="fas fa-plus"></i> 上架新商品
                        </button>
                    </div>
                    <div class="card p-0" style="overflow: hidden;">
                        <table class="seller-table">
                            <thead>
                                <tr>
                                    <th>商品資訊</th>
                                    <th>價格</th>
                                    <th>狀態</th>
                                    <th class="text-center">操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- JS Generated -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- VIEW: Orders -->
                <div id="seller-orders-panel" style="display: none;">
                    <h3 class="mb-2">訂單管理</h3>
                    <div class="card p-0" style="overflow: hidden;">
                        <table class="seller-table">
                            <thead>
                                <tr>
                                    <th>訂單編號</th>
                                    <th>買家</th>
                                    <th>總金額</th>
                                    <th>狀態</th>
                                    <th class="text-center">操作</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- JS Generated -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- VIEW: Add Product -->
                <div id="seller-add-product-panel" style="display: none;">
                    <div class="d-flex justify-between align-center mb-2">
                        <h3 class="mb-0">新增商品</h3>
                        <button class="btn btn-outline btn-sm" onclick="showSellerPanel('products')">
                            <i class="fas fa-arrow-left"></i> 返回列表
                        </button>
                    </div>

                    <div class="card">
                        <form onsubmit="submitNewProduct(event)">
                            <div class="form-group mb-2">
                                <label class="form-label">商品圖片</label>
                                <div class="form-upload-box">
                                    <i class="fas fa-plus mb-1"></i>
                                    <span>新增圖片</span>
                                </div>
                            </div>

                            <div class="form-group mb-1">
                                <label class="form-label">商品名稱</label>
                                <input type="text" id="prod-title" class="form-control" placeholder="例如：全新 貓咪罐頭 80g">
                            </div>

                            <div class="d-flex gap-md mb-1">
                                <div class="form-group" style="flex: 1;">
                                    <label class="form-label">商品分類</label>
                                    <select id="prod-category" class="form-control">
                                        <option>貓貓用品</option>
                                        <option>狗狗用品</option>
                                        <option>外出籠/包</option>
                                        <option>服飾/配件</option>
                                    </select>
                                </div>
                                <div class="form-group" style="flex: 1;">
                                    <label class="form-label">價格 (NT$)</label>
                                    <input type="number" id="prod-price" class="form-control" placeholder="0">
                                </div>
                            </div>

                            <div class="form-group mb-2">
                                <label class="form-label">商品描述</label>
                                <textarea class="form-control" rows="4"></textarea>
                            </div>

                            <div class="d-flex justify-between" style="margin-top: 2rem;">
                                <button type="button" class="btn btn-outline"
                                    onclick="showSellerPanel('products')">取消</button>
                                <button type="submit" class="btn btn-primary">立即上架</button>
                            </div>
                        </form>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <footer id="main-footer" style="background-color: #f9f9f9; margin-top: 4rem;"></footer>

    <script src="../../static/js/frontend/main.js"></script>
    <script>
        let products = [
            { id: 1, title: '全新貓咪自動餵食器', price: 1200, category: '貓貓用品', time: '5分前', img: 'https://images.unsplash.com/photo-1583337130417-3346a1be7dee?auto=format&fit=crop&q=80&w=400', seller: '李小明', stock: 1 },
            { id: 2, title: '寵物外出摺疊碗', price: 150, category: '外出籠/包', time: '2時前', img: 'https://images.unsplash.com/photo-1601758228041-f3b2795255f1?auto=format&fit=crop&q=80&w=400', seller: '李小明', stock: 0 }
        ];

        let orders = [
            { id: 'ORD-2024001', buyer: '陳小美', total: 1260, status: '待出貨' },
            { id: 'ORD-2023998', buyer: '林大為', total: 300, status: '已完成' }
        ];

        document.addEventListener('DOMContentLoaded', () => {
            showSellerPanel('overview');
        });

        function showSellerPanel(panelId) {
            const panels = ['overview', 'products', 'orders', 'add-product'];
            panels.forEach(p => {
                const el = document.getElementById('seller-' + p + '-panel');
                if (el) el.style.display = (p === panelId) ? 'block' : 'none';
            });

            document.querySelectorAll('.seller-menu-item').forEach(el => el.classList.remove('active'));
            const menuId = (panelId === 'add-product') ? 'menu-products' : 'menu-' + panelId;
            const menuEl = document.getElementById(menuId);
            if (menuEl) menuEl.classList.add('active');

            if (panelId === 'products') renderSellerProducts();
            if (panelId === 'orders') renderOrders();
            if (panelId === 'overview') updateStats();
        }

        function updateStats() {
            const activeCount = products.length;
            const pendingOrders = orders.filter(o => o.status === '待出貨').length;
            const stats = document.querySelectorAll('.seller-dashboard-card h3');
            if (stats.length >= 2) {
                stats[0].innerText = activeCount;
                stats[1].innerText = pendingOrders;
            }
        }

        function renderSellerProducts() {
            const tbody = document.querySelector('#seller-products-panel tbody');
            tbody.innerHTML = products.map(p => `
                <tr>
                    <td>
                        <div class="d-flex align-center gap-sm">
                            <img src="${p.img}" style="width: 40px; height: 40px; border-radius: 4px; object-fit: cover;">
                            ${p.title}
                        </div>
                    </td>
                    <td>$${p.price.toLocaleString()}</td>
                    <td><span class="badge ${p.stock <= 0 ? 'badge-secondary' : 'badge-success'}">${p.stock <= 0 ? '已售完' : '上架中'}</span></td>
                    <td class="text-center">
                        <div class="d-flex justify-center gap-sm">
                            <button class="btn btn-sm btn-outline" onclick="editProduct(${p.id})"><i class="fas fa-edit"></i></button>
                            <button class="btn btn-sm btn-outline text-danger" onclick="deleteProduct(${p.id})"><i class="fas fa-trash-alt"></i></button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function renderOrders() {
            const tbody = document.querySelector('#seller-orders-panel tbody');
            tbody.innerHTML = orders.map(o => `
                <tr>
                    <td>#${o.id}</td>
                    <td>${o.buyer}</td>
                    <td>$${o.total.toLocaleString()}</td>
                    <td><span class="badge ${o.status === '待出貨' ? 'badge-success' : 'badge-secondary'}">${o.status}</span></td>
                    <td class="text-center">
                        ${o.status === '待出貨' ? `<button class="btn btn-sm btn-primary" onclick="shipOrder('${o.id}')">安排出貨</button>` : `<button class="btn btn-sm btn-outline">查看詳情</button>`}
                    </td>
                </tr>
            `).join('');
        }

        function shipOrder(id) {
            const order = orders.find(o => o.id === id);
            if (order) {
                order.status = '已出貨';
                renderOrders();
                updateStats();
                window.showToast('訂單已更新為已出貨');
            }
        }

        function deleteProduct(id) {
            if (confirm('確定要刪除此商品嗎？')) {
                products = products.filter(p => p.id !== id);
                renderSellerProducts();
                updateStats();
                window.showToast('商品已刪除');
            }
        }

        function editProduct(id) {
            const p = products.find(p => p.id === id);
            const newPrice = prompt('請輸入新的價格：', p.price);
            if (newPrice && !isNaN(newPrice)) {
                p.price = parseInt(newPrice);
                renderSellerProducts();
                window.showToast('價格已更新');
            }
        }

        function submitNewProduct(e) {
            e.preventDefault();
            const title = document.getElementById('prod-title').value;
            const price = document.getElementById('prod-price').value;
            const category = document.getElementById('prod-category').value;

            if (!title || !price) { alert('請填寫完整資訊'); return; }

            products.unshift({
                id: Date.now(),
                title: title,
                price: parseInt(price),
                category: category,
                time: '剛剛',
                img: 'https://images.unsplash.com/photo-1583337130417-3346a1be7dee?auto=format&fit=crop&q=80&w=400',
                stock: 1
            });

            window.showToast('商品上架成功');
            showSellerPanel('products');
        }
    </script>
</body>

</html>