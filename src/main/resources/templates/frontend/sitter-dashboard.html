<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¿æ¯å°ˆå€ | PetGuardian</title>
    <link rel="stylesheet" href="../../static/css/frontend/style.css">
    <link rel="stylesheet" href="../../static/css/frontend/components.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../../static/css/frontend/dashboard.css">
</head>

<body>

    <header id="main-header" class="header"></header>

    <div class="container dashboard-container">

        <!-- Sidebar -->
        <div class="sidebar">
            <div class="text-center mb-2">
                <div class="avatar-wrapper">
                    <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Aneka" class="avatar">
                    <span
                        style="position: absolute; bottom: 0; right: 0; background: var(--success); color: white; border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; border: 2px solid white; font-size: 0.7rem;">âœ“</span>
                </div>
                <h4>é™³å¤§å±±</h4>
                <p style="color: var(--primary-color); font-weight: 600; font-size: 0.9rem;">é‡‘ç‰Œä¿æ¯ ğŸ¥‡</p>
                <div class="d-flex justify-center gap-xs mt-1" style="color: var(--warning); font-size: 0.9rem;">
                    <i class="fas fa-star"></i> 4.8 (85)
                </div>
            </div>

            <nav>
                <div class="menu-item active" onclick="showSection('dashboard')">
                    <i class="fas fa-chart-line"></i> å„€è¡¨æ¿
                </div>
                <div class="menu-item" onclick="showSection('jobs')">
                    <i class="fas fa-clipboard-list"></i> å·¥ä½œç®¡ç†
                    <span class="badge badge-accent" style="margin-left: auto;">2</span>
                </div>
                <div class="menu-item" onclick="showSection('profile')">
                    <i class="fas fa-user-md"></i> æœå‹™è¨­å®š
                </div>
            </nav>
        </div>

        <!-- Content -->
        <div class="main-content">

            <!-- Dashboard Overview -->
            <div id="dashboard" class="tab-content active">
                <h2 class="mb-2">ä»Šæ—¥æ¦‚æ³</h2>
                <div class="horizontal-scroll">
                    <div class="stat-card">
                        <h4 style="color: #666; font-size: 0.9rem;">ä»Šæ—¥é ç´„</h4>
                        <div style="font-size: 2rem; font-weight: 700;">3</div>
                    </div>
                    <div class="stat-card">
                        <h4 style="color: #666; font-size: 0.9rem;">æœ¬æœˆæ”¶ç›Š</h4>
                        <div style="font-size: 2rem; font-weight: 700; color: var(--success);">$12k</div>
                    </div>
                    <div class="stat-card">
                        <h4 style="color: #666; font-size: 0.9rem;">å¾…ç¢ºèª</h4>
                        <div style="font-size: 2rem; font-weight: 700; color: var(--warning);">2</div>
                    </div>
                </div>

                <h3 class="mb-1 mt-2">å³å°‡åˆ°ä¾†</h3>
                <div class="job-card pending">
                    <div class="d-flex justify-between align-center mb-1">
                        <div class="d-flex gap-sm align-center">
                            <div
                                style="background: var(--secondary-color); padding: 0.5rem; border-radius: 8px; text-align: center; min-width: 60px;">
                                <div style="font-weight: 700; color: var(--primary-color);">12/28</div>
                                <div style="font-size: 0.8rem;">14:00</div>
                            </div>
                            <div>
                                <h4 style="margin: 0;">æ•£æ­¥é›ç‹— (çš®çš®)</h4>
                                <div style="color: #666; font-size: 0.9rem;">ğŸ“ å°åŒ—å¸‚å¤§å®‰å€ä¿¡ç¾©è·¯</div>
                            </div>
                        </div>
                        <button class="btn btn-primary btn-sm">å°èˆª</button>
                    </div>
                    <div class="d-flex gap-sm" style="border-top: 1px solid #eee; padding-top: 1rem;">
                        <span class="badge badge-secondary">å‚™è¨»ï¼šçš®çš®æ¯”è¼ƒæ€•ç”Ÿ</span>
                        <span class="badge badge-secondary">æ™‚é•·ï¼š30åˆ†é˜</span>
                    </div>
                </div>
            </div>

            <!-- Jobs Management -->
            <div id="jobs" class="tab-content">
                <h2 class="mb-2">å·¥ä½œé …ç›®ç®¡ç†</h2>

                <!-- Status Pills -->
                <div class="d-flex gap-sm mb-3">
                    <button class="btn btn-outline btn-sm active" onclick="filterJobs('all', this)">å…¨éƒ¨</button>
                    <button class="btn btn-outline btn-sm" onclick="filterJobs('pending', this)">å¾…æ¥å–®</button>
                    <button class="btn btn-outline btn-sm" onclick="filterJobs('ongoing', this)">é€²è¡Œä¸­</button>
                    <button class="btn btn-outline btn-sm" onclick="filterJobs('collect', this)">å¾…æ”¶æ¬¾</button>
                </div>

                <div id="active-jobs-list">
                    <!-- Job Card 1: Pending -->
                    <div class="job-card job-item-card status-pending" style="border-left-color: var(--warning);">
                        <div class="job-card-header">
                            <div class="customer-info">
                                <h4 class="mb-0">æ—å¤§ç‚º</h4>
                                <span class="order-id">#BK-7890</span>
                            </div>
                            <span class="badge badge-warning">å¾…æ¥å–®</span>
                        </div>

                        <div class="job-detail-grid">
                            <div class="detail-item">
                                <i class="fas fa-paw"></i>
                                <span>é™ªä¼´äº’å‹• (è±†è±† Â· ä¸­å‹çŠ¬)</span>
                            </div>
                            <div class="detail-item">
                                <i class="far fa-clock"></i>
                                <span>2024/01/05 14:00 - 16:00</span>
                            </div>
                        </div>

                        <div class="job-footer">
                            <div class="income-box">
                                <span class="label">é ä¼°æ”¶å…¥</span>
                                <span class="amount">$600</span>
                            </div>
                            <div class="action-buttons">
                                <button class="btn btn-outline btn-sm" onclick="openCancelModal('BK-7890')">å©‰æ‹’</button>
                                <button class="btn btn-primary btn-sm"
                                    onclick="handleJobAction('BK-7890', 'confirm')">ç¢ºå®šæ¥å–®</button>
                            </div>
                        </div>
                    </div>

                    <!-- Job Card 2: Ongoing -->
                    <div class="job-card job-item-card status-ongoing" style="border-left-color: var(--primary-color);">
                        <div class="job-card-header">
                            <div class="customer-info">
                                <h4 class="mb-0">ç‹å°æ˜</h4>
                                <span class="order-id">#BK-7888</span>
                            </div>
                            <span class="badge badge-primary">é€²è¡Œä¸­</span>
                        </div>

                        <div class="job-detail-grid">
                            <div class="detail-item">
                                <i class="fas fa-paw"></i>
                                <span>æ—¥å¸¸ç…§è­· (å’ªå’ª Â· è²“)</span>
                            </div>
                            <div class="detail-item">
                                <i class="far fa-clock"></i>
                                <span>2024/01/05 11:00 - 13:00</span>
                            </div>
                        </div>

                        <div class="job-footer">
                            <div class="income-box">
                                <span class="label">é ä¼°æ”¶å…¥</span>
                                <span class="amount">$500</span>
                            </div>
                            <div class="action-buttons">
                                <button class="btn btn-primary btn-sm"
                                    onclick="handleJobAction('BK-7888', 'collect')">å®Œå·¥æ”¶æ¬¾</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Booking History -->
            <div id="history" class="tab-content">
                <h2 class="mb-2">é ç´„è¨‚å–®ç´€éŒ„</h2>
                <div class="d-flex justify-between align-center mb-2">
                    <div class="d-flex gap-sm">
                        <button class="btn btn-outline btn-sm active" onclick="filterHistory('all', this)">å…¨éƒ¨</button>
                        <button class="btn btn-outline btn-sm" onclick="filterHistory('completed', this)">å·²å®Œæˆ</button>
                        <button class="btn btn-outline btn-sm" onclick="filterHistory('cancelled', this)">å·²å–æ¶ˆ</button>
                    </div>
                    <div style="max-width: 250px;">
                        <input type="text" class="form-control" placeholder="æœå°‹è¨‚å–®ç·¨è™Ÿæˆ–å§“å..."
                            style="height: 32px; font-size: 0.85rem;">
                    </div>
                </div>

                <div class="job-card">
                    <div class="d-flex justify-between align-center">
                        <div>
                            <h4 style="margin:0;">é™³å°ç¾</h4>
                            <div style="color: #999; font-size: 0.8rem;">2023/12/20 Â· æ•£æ­¥é›ç‹—</div>
                        </div>
                        <div class="text-right">
                            <div style="font-weight: 700;">$400</div>
                            <span class="badge badge-secondary">å·²å®Œæˆ</span>
                        </div>
                    </div>
                </div>
                <div class="job-card" style="opacity: 0.7;">
                    <div class="d-flex justify-between align-center">
                        <div>
                            <h4 style="margin:0;">å¼µå¤§è¡›</h4>
                            <div style="color: #999; font-size: 0.8rem;">2023/12/15 Â· åŸºæœ¬æ¸…æ½”</div>
                        </div>
                        <div class="text-right">
                            <div style="font-weight: 700;">$0</div>
                            <span class="badge" style="background: #eee; color: #666;">å·²å–æ¶ˆ</span>
                        </div>
                    </div>
                    <div style="font-size: 0.8rem; color: #fa5252; margin-top: 0.5rem;">ç†ç”±ï¼šè¡Œç¨‹è¡çª</div>
                </div>
            </div>

            <!-- Profile Settings -->
            <div id="profile" class="tab-content">
                <h2 class="mb-2">æœå‹™è³‡è¨Šè¨­å®š</h2>

                <div class="card">
                    <form onsubmit="saveSettings(event)">
                        <h3 class="mb-1"
                            style="font-size: 1.1rem; border-left: 4px solid var(--primary-color); padding-left: 10px;">
                            å¯µç‰©ç¨®é¡</h3>
                        <div class="form-group mb-2">
                            <div class="checkbox-grid">
                                <label class="check-item">
                                    <input type="checkbox" checked> å°å‹çŠ¬
                                    <input type="checkbox" checked> ä¸­å‹çŠ¬
                                    <input type="checkbox"> å¤§å‹çŠ¬
                                    <input type="checkbox" checked>è²“
                                </label>
                            </div>
                        </div>

                        <h3 class="mb-1 mt-2"
                            style="font-size: 1.1rem; border-left: 4px solid var(--primary-color); padding-left: 10px;">
                            æœå‹™é …ç›®</h3>
                        <div class="form-group mb-2">
                            <div class="checkbox-grid">
                                <label class="check-item"><input type="checkbox" checked> æ—¥å¸¸ç…§è­·</label>
                                <label class="check-item"><input type="checkbox" checked> é™ªä¼´äº’å‹•</label>
                                <label class="check-item"><input type="checkbox"> åŸºæœ¬æ¸…æ½”</label>
                            </div>
                        </div>

                        <h3 class="mb-1 mt-2"
                            style="font-size: 1.1rem; border-left: 4px solid var(--primary-color); padding-left: 10px;">
                            æœå‹™åœ°å€ (åœ°åœ–)</h3>
                        <div class="d-flex gap-sm mb-2">
                            <div style="flex:1">
                                <label class="form-label">ç¸£å¸‚</label>
                                <select class="form-control">
                                    <option>å°åŒ—å¸‚</option>
                                    <option>æ–°åŒ—å¸‚</option>
                                </select>
                            </div>
                            <div style="flex:1">
                                <label class="form-label">é„‰é®å¸‚å€</label>
                                <select class="form-control">
                                    <option>å¤§å®‰å€</option>
                                    <option>ä¿¡ç¾©å€</option>
                                    <option>ä¸­æ­£å€</option>
                                </select>
                            </div>
                        </div>

                        <h3 class="mb-1 mt-2"
                            style="font-size: 1.1rem; border-left: 4px solid var(--primary-color); padding-left: 10px;">
                            æ”¶è²»äº‹é …</h3>
                        <div class="form-group mb-2">
                            <label class="form-label">æ¯å°æ™‚è²»ç‡ ($)</label>
                            <input type="number" class="form-control" value="500">
                        </div>

                        <h3 class="mb-1 mt-2"
                            style="font-size: 1.1rem; border-left: 4px solid var(--primary-color); padding-left: 10px;">
                            é ç´„ç®¡ç†</h3>
                        <div class="mb-2">
                            <p class="form-label mb-1">é–‹æ”¾é ç´„æ™‚æ®µ</p>
                            <div class="availability-grid">
                                <div class="time-slot" onclick="toggleSlot(this)">08:00-10:00</div>
                                <div class="time-slot active" onclick="toggleSlot(this)">10:00-12:00</div>
                                <div class="time-slot active" onclick="toggleSlot(this)">14:00-16:00</div>
                                <div class="time-slot active" onclick="toggleSlot(this)">16:00-18:00</div>
                                <div class="time-slot" onclick="toggleSlot(this)">18:00-20:00</div>
                                <div class="time-slot" onclick="toggleSlot(this)">20:00-22:00</div>
                            </div>
                            <p style="font-size: 0.8rem; color: #999; margin-top: 0.5rem;">* é»æ“Šåˆ‡æ›å¯é ç´„ / ç„¡æ³•é ç´„ç‹€æ…‹</p>
                        </div>

                        <button type="submit" class="btn btn-primary btn-block mt-2">å„²å­˜æ‰€æœ‰è¨­å®š</button>
                    </form>
                </div>
            </div>

        </div>
    </div>

    <!-- Cancellation Modal -->
    <div id="cancel-modal" class="modal-backdrop" style="display:none;">
        <div class="modal">
            <h3 class="mb-1">å–æ¶ˆé ç´„</h3>
            <p class="mb-1" style="font-size: 0.9rem;">è«‹é¸æ“‡å–æ¶ˆåŸå› ï¼š</p>
            <textarea id="cancel-reason" class="form-control mb-2" placeholder="è«‹è¼¸å…¥åŸå›  (ä¾‹å¦‚ï¼šè¡Œç¨‹è¡çªã€çªç™¼ç‹€æ³...)"
                rows="3"></textarea>
            <div class="d-flex gap-sm">
                <button class="btn btn-outline btn-block" onclick="closeCancelModal()">ä¸å–æ¶ˆäº†</button>
                <button class="btn btn-primary btn-block" style="background:var(--danger);"
                    onclick="confirmCancel()">ç¢ºå®šå–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <footer id="main-footer" style="background-color: #f9f9f9; margin-top: 4rem;"></footer>

    <style>
        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .check-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
            cursor: pointer;
        }

        .availability-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
            gap: 10px;
        }

        .time-slot {
            padding: 8px;
            text-align: center;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .time-slot:hover {
            border-color: var(--primary-color);
        }

        .time-slot.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            max-width: 400px;
            width: 90%;
        }

        .btn-block {
            width: 100%;
        }

        .text-right {
            text-align: right;
        }

        /* Enhanced Job Management Styles */
        .job-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #f0f0f0;
        }

        .order-id {
            font-size: 0.8rem;
            color: #999;
        }

        .job-detail-grid {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .detail-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
            color: #555;
        }

        .detail-item i {
            color: var(--primary-color);
            width: 16px;
            text-align: center;
        }

        .job-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 1rem;
            border-top: 1px solid #f0f0f0;
        }

        .income-box {
            display: flex;
            flex-direction: column;
        }

        .income-box .label {
            font-size: 0.75rem;
            color: #999;
        }

        .income-box .amount {
            font-size: 1.1rem;
            font-weight: 700;
            color: #e67e22;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }
    </style>

    <script src="../../static/js/frontend/main.js"></script>
    <script>
        function showSection(id) {
            document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('active'));
            // If called from JS without event
            if (window.event && window.event.currentTarget.classList.contains('menu-item')) {
                window.event.currentTarget.classList.add('active');
            } else {
                // Find matching menu item by icon or text (fallback)
                const items = document.querySelectorAll('.sidebar .menu-item');
                items.forEach(item => {
                    const text = item.innerText.trim();
                    if (id === 'jobs' && text.includes('å·¥ä½œ')) item.classList.add('active');
                    else if (id === 'history' && text.includes('ç´€éŒ„')) item.classList.add('active');
                });
            }

            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        function toggleSlot(el) {
            el.classList.toggle('active');
        }

        function saveSettings(e) {
            e.preventDefault();
            window.showToast('è¨­å®šå·²æˆåŠŸå„²å­˜ï¼');
        }

        let pendingCancelId = null;
        function openCancelModal(id) {
            pendingCancelId = id;
            document.getElementById('cancel-modal').style.display = 'flex';
        }

        function closeCancelModal() {
            document.getElementById('cancel-modal').style.display = 'none';
        }

        function confirmCancel() {
            const reason = document.getElementById('cancel-reason').value;
            if (!reason) {
                alert('è«‹è¼¸å…¥å–æ¶ˆåŸå› ');
                return;
            }
            window.showToast(`é ç´„ #${pendingCancelId} å·²å–æ¶ˆ`);
            closeCancelModal();
            // Logic to move to history would go here
        }

        function handleJobAction(id, action) {
            if (action === 'confirm') {
                window.showToast(`å·²æ¥ä¸‹é ç´„ #${id}`);
            } else if (action === 'collect') {
                window.showToast(`å·²ç¢ºèªæ”¶æ¬¾ï¼Œæœå‹™é †åˆ©å®Œæˆï¼`);
            }
        }

        function filterHistory(status, btn) {
            const historyTabs = document.querySelectorAll('#history .btn-outline');
            historyTabs.forEach(tab => tab.classList.remove('active'));
            btn.classList.add('active');

            // Logic to filter the list would go here
        }

        function filterJobs(status, btn) {
            const tabs = document.querySelectorAll('#jobs .btn-outline');
            tabs.forEach(tab => tab.classList.remove('active'));
            btn.classList.add('active');

            const items = document.querySelectorAll('.job-item-card');
            items.forEach(item => {
                if (status === 'all') {
                    item.style.display = 'block';
                } else if (status === 'collect') {
                    // Ongoing is the logical state for 'collect' action
                    item.style.display = item.classList.contains('status-ongoing') ? 'block' : 'none';
                } else {
                    item.style.display = item.classList.contains('status-' + status) ? 'block' : 'none';
                }
            });
        }

        // Add new menu item to sidebar dynamically if needed
        document.addEventListener('DOMContentLoaded', () => {
            const nav = document.querySelector('.sidebar nav');
            const historyItem = document.createElement('div');
            historyItem.className = 'menu-item';
            historyItem.innerHTML = '<i class="fas fa-history"></i> é ç´„ç´€éŒ„';
            historyItem.onclick = () => showSection('history');

            // Insert before Earnings
            const earningsItem = document.querySelector('.menu-item:last-child');
            nav.insertBefore(historyItem, earningsItem);
        });
    </script>
</body>

</html>