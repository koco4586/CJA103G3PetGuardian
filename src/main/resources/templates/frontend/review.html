<!doctype html>
<html lang="zh-TW" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Pet Guardian - 評價管理</title>
    <link rel="stylesheet" th:href="@{/css/frontend/style.css}">
    <link rel="stylesheet" th:href="@{/css/frontend/components.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/frontend/dashboard.css}">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Arial, sans-serif; 
            background: linear-gradient(135deg, #f5d876 0%, #e8a87c 50%, #c38d9e 100%);
            min-height: 100vh;
        }

/* 主內容區 */
        .main-content {
            margin-left: 0;
            transition: 0.3s;
    min-height: 100vh;
    width: 100%;    /* 改為 100% */
    display: flex;
    flex-direction: column;
    align-items: center; /* 水平置中內容 */
        }
        .sidebar.collapsed + .main-content { 
            margin-left: 0;
            width: 100%;
        }

        header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .menu-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.2rem;
        }
        .menu-btn:hover { background: #2980b9; }
        .sub { color: #777; font-size: 0.9rem; margin-top: 5px; }

        section { 
            padding: 30px;
            width: 100%;
        }

        
        

        /* 卡片 */
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            width: 100%;
        }
        .card h3 {
            margin-bottom: 25px;
            color: #2c3e50;
            font-size: 1.5rem;
        }

        /* 表格 */
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #555;
        }
        tr:hover {
            background: #f8f9fa;
        }

        /* 檢舉類型按鈕 */
        .report-type-container { 
            display: flex; 
            gap: 15px; 
            margin-bottom: 25px; 
        }
        .type-btn { 
            flex: 1; 
            padding: 20px; 
            border: 2px solid #ddd; 
            border-radius: 12px; 
            background: #fff; 
            cursor: pointer; 
            text-align: center;
            transition: 0.3s;
        }
        .type-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .type-btn.active { 
            border-color: #c38d9e; 
            color: #c38d9e; 
            background: #fff5f5; 
            box-shadow: 0 5px 15px rgba(195, 141, 158, 0.2);
        }

        /* 圖片上傳 */
        
        /* 表單元素 */
        textarea { 
            width: 100%; 
            padding: 12px; 
            border: 2px solid #ddd; 
            border-radius: 10px; 
            min-height: 120px;
            font-family: inherit;
            transition: 0.3s;
        }
        textarea:focus {
            outline: none;
            border-color: #c38d9e;
            box-shadow: 0 0 0 3px rgba(195, 141, 158, 0.1);
        }
        input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            background: white;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95rem;
            transition: 0.3s;
            margin-right: 5px;
            color: white;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        
        

        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        .form-group {
            margin-bottom: 20px;
        }    </style>
   
</head>

<body>
    
    <header id="main-header" class="header"></header>
    
	
        <div class="logo">
           
        </div>
    <div class="main-content">
        <header>
            <button class="menu-btn" onclick="toggleSidebar()">☰</button>
            <img src="https://images.unsplash.com/photo-1518791841217-8f162f1e1131?q=80&w=60&auto=format&fit=crop"
                alt="logo" style="width:48px;height:48px;border-radius:10px;object-fit:cover;">
            <div>
                <h1>評價檢舉</h1>
                <div class="sub">處理全站（預約訂單/訂單）違規評價申訴</div>
            </div>
        </header>

        <section>
            <div class="tab-container">
                
                <div style="margin-bottom: 20px;">
    <h2 style="color: #2c3e50; font-size: 1.8rem;">
        <i class="fa-solid fa-pen-to-square"></i> 發起新申訴
    </h2>
</div>
</div>

			
           <div id="user-section" class="content-section active">
    <div class="card">
        <h3>填寫申訴資訊</h3>
                
                
                
                    
                    <div class="report-type-container">
                        
                        <div class="type-btn">
                            <i class="fa-solid fa-calendar-check"></i><br>檢舉預約訂單
                        </div>
                        <div class="type-btn">
                            <i class="fa-solid fa-shop"></i><br>檢舉訂單
                        </div>
                    </div>

                    <input type="hidden" name="bookingOrderId" value="1">

                    <div style="margin-bottom: 15px;">
                        <label>檢舉詳細內容：</label>
                        <textarea id="reportReason" name="reportReason" placeholder="請描述發生經過..."></textarea>
                    </div>

                    

                    
                
    <div style="text-align: center;">
        <button type="button" onclick="confirmSubmit()" class="btn" style="background: #ff6b6b; width: 240px; padding: 12px; font-weight: bold;">提交申訴</button>
    </div>

                </div>
                </div>
                </section>
				</div>
           
        
    
    
    

<script type="text/javascript">




//簡單顯示選擇了幾張圖片


//3. 處理檢舉類別切換 (修正後的 JS)
const typeBtns = document.querySelectorAll('.type-btn');

typeBtns.forEach(btn => {
    btn.addEventListener('click', function() {
        // 切換按鈕樣式
        typeBtns.forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        
        // 這裡移除對 nameLabel 的操作，因為你已經不需要「檢舉對象名稱」了
        console.log("切換至：" + this.innerText.trim());
    });
});


function confirmSubmit() {
    const form = document.getElementById('complaintForm');
    const reason = document.querySelector('textarea[name="reportReason"]').value;

    if (!reason.trim()) {
        Swal.fire('提醒', '請填寫檢舉詳細內容', 'warning');
        return;
    }

    // 1. 顯示「確定要提交嗎？」
    Swal.fire({
        title: '確定要提交嗎？',
        text: "提交後將進入審核流程，請確認內容無誤。",
        icon: 'question',
        showCancelButton: true,
        confirmButtonColor: '#ff6b6b',
        cancelButtonColor: '#aaa',
        confirmButtonText: '確定提交',
        cancelButtonText: '取消'
    }).then((result) => {
        if (result.isConfirmed) {
            // 2. 使用 AJAX 提交或是直接 submit
            // 為了顯示「請等待審核」，我們先模擬提交成功
            submitByAjax();
        }
    });
}

function submitByAjax() {
    // 1. 取得資料
    const reasonElement = document.getElementById('reportReason');
    const reason = reasonElement ? reasonElement.value : "";
    
    // 取得隱藏的訂單 ID
    const bookingOrderId = document.querySelector('input[name="bookingOrderId"]').value;

    // 2. 使用 URLSearchParams 封裝資料 (這最符合 Spring VO 的接收格式)
    const formData = new URLSearchParams();
    formData.append('reportReason', reason);
    formData.append('bookingOrderId', bookingOrderId);

    fetch('/pet/submitComplaint', {
        method: 'POST',
        body: formData
    })
    .then(response => {
        if (response.ok || response.redirected) {
            // 3. 顯示「申訴成功」
            Swal.fire({
                title: '申訴成功！',
                text: '您的申訴已收到，請耐心等待管理員審核。',
                icon: 'success',
                confirmButtonText: '太好了',
                timer: 3000 // 3秒後自動關閉
            }).then(() => {
                // 跳轉回首頁或儀表板
                window.location.href = '/pet/index'; 
            });
        } else {
            Swal.fire('錯誤', '提交失敗，請稍後再試', 'error');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        Swal.fire('錯誤', '系統連線異常', 'error');
    });
}

</script>

<footer id="main-footer" style="margin-top: 4rem;"></footer>

    <script th:src="@{/js/frontend/main.js}">
    
    </script>

</body>

</html>