<!DOCTYPE html>
<html lang="zh-Hant" xmlns:th="http://www.thymeleaf.org">

<head>
    <title>所有寵物</title>

    <link rel="stylesheet" th:href="@{/css/frontend/style.css}">
    <link rel="stylesheet" th:href="@{/css/frontend/components.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/frontend/dashboard.css}">

    <style>
        body {
            background-image: url("/images/pet/83099.jpg");
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }

        table#table-1 {
            width: 900px;
            margin: 0 auto 10px;
            border: none;
            background-color: transparent;
        }

        .header-container {
            position: relative;
            width: 100%;
            padding: 200px 0;
            margin-top: -150px;
            margin-bottom: -180px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .header-container::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url("/images/pet/labels.png");
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            opacity: 0.8;
            z-index: -1;
        }

        .header-container h3 {
            font-size: 2rem;
            color: #333;
            margin: 0;
            font-weight: bold;
        }

        .header-container a {
            font-size: 1rem;
            color: #000;
            text-decoration: none;
            font-weight: bold;
            border-bottom: 2px solid #333;
        }

        table#table-1 h3 {
            color: #333;
            margin: 10px 0;
        }

        table {
            width: 1000px;
            background-color: white;
            margin-top: 5px;
            margin-bottom: 5px;
            border-collapse: collapse;
            margin: 0 auto;
        }

        th {
            background-color: #F2F2F2;
        }

        img.pet-img {
            max-width: 120px;
            height: 120px;
            object-fit: cover;
            border-radius: 5px;
        }

        table#table-1,
        table#table-1 th,
        table#table-1 td {
            border: none !important;
        }

        table:not(#table-1),
        table:not(#table-1) th,
        table:not(#table-1) td {
            border: 1px solid #CCCCFF !important;
            padding: 8px;
            text-align: center;
        }

        table:not(#table-1) {
            width: 1100px;
            background-color: white;
            border-collapse: collapse;
            margin: 0 auto;
        }

        .badge-mine {
            background: #e1f5fe;
            color: #0288d1;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.75rem;
        }

        .badge-other {
            background: #fff3e0;
            color: #e65100;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.75rem;
        }

        .btn-view {
            color: #3498db;
            text-decoration: none;
            font-weight: bold;
        }

        .btn-edit {
            color: #2ecc71;
            text-decoration: none;
            font-weight: bold;
        }

        .btn-delete {
            color: #e74c3c;
            text-decoration: none;
            font-weight: bold;
        }

        #main-footer {
            background-color: #f9f9f9 !important;
            margin-top: 4rem;
        }

        #main-footer .container {
            background-color: transparent !important;
        }

        .pagination-group {
            text-align: center;
            margin-top: 30px;
            margin-bottom: 30px;
        }

        .pagination-group a {
            text-decoration: none;
            color: #3498db;
            font-weight: bold;
            margin: 0 5px;
        }
    </style>
</head>

<body>

    <header id="main-header" class="header"></header>

    <div align="center">
        <table id="table-1">
            <tr>
                <td>
                    <div class="header-container">
                        <h3 class="title-text">所有寵物</h3>
                        <div class="nav-label">
                            <h4><a th:href="@{/pet/dashboard}">回首頁</a></h4>
                        </div>
                    </div>
                </td>
            </tr>
        </table>

        <table>
            <thead>
                <tr>
                    <th>編號</th>
                    <th>姓名</th>
                    <th>種類</th>
                    <th>體型</th>
                    <th>年齡</th>
                    <th>圖片</th>
                    <th>性別</th>
                    <th>備註</th>
                    <th>建立時間</th>
                    <th>最後更新</th>
                    <th>功能</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="pet : ${petlist}">
                    <td th:text="${pet.petId}"></td>
                    <td th:text="${pet.petName}" style="font-weight: bold;"></td>
                    <td th:text="${pet.typeName}"></td>
                    <td th:text="${pet.sizeName}"></td>
                    <td th:text="${pet.petAge != null ? pet.petAge + ' 歲' : '未填寫'}"></td>
                    <td>
                        <img class="pet-img" th:if="${pet.hasImage == true}" th:src="@{/pet/img/{id}(id=${pet.petId})}"
                            alt="寵物圖片">
                        <span th:if="${pet.hasImage == null or pet.hasImage == false}" style="color:#ccc;">(無圖片)</span>
                    </td>
                    <td th:text="${pet.petGender == 0 ? '母' : '公'}"></td>
                    <td th:text="${pet.petDescription}"></td>
                    <td th:text="${pet.createdTimeText}"></td>
                    <td th:text="${pet.updatedAtText}"></td>
                    <td>
                        <a th:href="@{/pet/one(petId=${pet.petId})}" class="btn-view">查看</a>
                        <span th:if="${session.memId != null and session.memId == pet.memId}">
                            | <a th:href="@{/pet/getOne_For_Update(petId=${pet.petId})}" class="btn-edit">修改</a>
                            | <a href="javascript:void(0);" th:onclick="'deletePet(' + ${pet.petId} + ')'"
                                class="btn-delete">刪除</a>
                        </span>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- 分頁邏輯：滿 9 隻才顯示 -->
    <div class="pagination-group" th:if="${rowNumber >= 9}">
        <span th:if="${whichPage > 1}">
            <a th:href="@{/pet/all(whichPage=1)}">至第一頁</a>
            <a th:href="@{/pet/all(whichPage=${whichPage - 1})}">◀ 上一頁</a>
        </span>

        &nbsp;[ 第 <span th:text="${whichPage}"></span> / <span th:text="${pageNumber}"></span> 頁 ]&nbsp;

        <span th:if="${whichPage < pageNumber}">
            <a th:href="@{/pet/all(whichPage=${whichPage + 1})}">下一頁 ▶</a>
            <a th:href="@{/pet/all(whichPage=${pageNumber})}">至最後一頁</a>
        </span>
    </div>

    <footer id="main-footer"></footer>

    <script th:src="@{/js/frontend/main.js}"></script>
    <script>
        function deletePet(petId) {
            if (!confirm("確定要刪除嗎？")) return;
            fetch(`/pet/delete?petId=${petId}`, { method: 'POST' })
                .then(res => res.text())
                .then(text => {
                    if (text === "success") {
                        alert("刪除成功！");
                        location.reload();
                    } else {
                        alert("刪除失敗：" + text);
                    }
                })
                .catch(error => {
                    console.error("發生錯誤:", error);
                    alert("系統發生錯誤，請稍後再試。");
                });
        }
    </script>

</body>

</html>