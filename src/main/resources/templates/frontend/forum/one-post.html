<!DOCTYPE html>
<html lang="zh-TW" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>[[${forumPostVO.postTitle}]] | PetGuardian</title>
    <link rel="stylesheet" th:href="@{/css/frontend/style.css}">
    <link rel="stylesheet" th:href="@{/css/frontend/components.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* (æ­¤è™•ä¿ç•™ä½ åŸå§‹çš„ style è¨­å®š) */
        :root { --primary-orange: #ff9800; --deep-brown: #5d4037; --soft-bg: #fdfdfd; }
        body { background-color: #f8f9fa; font-family: "Microsoft JhengHei", Arial, sans-serif; margin: 0; padding: 0; }
        .forum-header-mini { background: linear-gradient(135deg, #fffcf5 0%, #faedcd 100%); padding: 1.5rem 0; margin-bottom: 2rem; border-bottom-left-radius: 24px; border-bottom-right-radius: 24px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05); }
        .main-container { display: flex; max-width: 1200px; margin: 0 auto; gap: 24px; padding: 0 20px 40px; align-items: flex-start; }
        .post-user-sidebar { width: 160px; flex-shrink: 0; background: #fff; border-radius: 16px; padding: 24px 15px; text-align: center; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05); position: sticky; top: 20px; border: 1px solid #eee; }
        .user-avatar { width: 90px; height: 90px; border-radius: 50%; margin-bottom: 15px; border: 3px solid var(--primary-orange); object-fit: cover; }
        .user-name { font-weight: 800; color: var(--deep-brown); font-size: 1.1rem; margin-bottom: 8px; }
        .post-article-area { flex: 1; background: #fff; border-radius: 16px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05); overflow: hidden; border: 1px solid #eee; }
        .article-content-wrapper { padding: 30px; }
        .btn-back { text-decoration: none; color: var(--primary-orange); font-weight: 800; display: inline-flex; align-items: center; gap: 8px; margin-bottom: 20px; transition: transform 0.2s; }
        .btn-back:hover { transform: translateX(-5px); }
        .post-title { font-size: 1.8rem; font-weight: 900; color: var(--deep-brown); margin: 0 0 15px 0; }
        .post-meta-top { color: orange; font-size: 0.9rem; font-weight: 600; margin-bottom: 24px; display: flex; gap: 20px; border-bottom: 2px solid #f9f9f9; padding-bottom: 15px; }
		.post-img-box { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 12px; margin-bottom: 25px; }
		.zoomable-img { width: 100%; height: 180px; object-fit: cover; border-radius: 12px; cursor: zoom-in; transition: transform 0.2s, box-shadow 0.2s; }
		.zoomable-img:hover { transform: translateY(-3px); box-shadow: 0 6px 15px rgba(255, 152, 0, 0.2); }
		.post-img-box:has(> :only-child) .zoomable-img { width: 300px; height: 300px; }
        .post-main-text { line-height: 1.8; font-size: 1.05rem; font-weight: 500; color: #444; white-space: pre-wrap; min-height: 200px; }
        .comment-section { background: #fffcf8; border-top: 1px solid #f0e6d6; padding: 30px; }
        .comment-section h4 { font-weight: 800; color: var(--deep-brown); margin-bottom: 20px; border-left: 4px solid var(--primary-orange); padding-left: 12px; }
        .comment-item { display: flex; gap: 15px; padding: 18px 0; border-bottom: 1px solid #eee; }
        .comment-user-mini-img { width: 45px; height: 45px; border-radius: 50%; border: 2px solid var(--primary-orange); }
        .comment-user-name { font-weight: 800; font-size: 14px; color: var(--primary-orange); margin-right: 10px; }
        .reply-box { margin-top: 30px; background: #fff; padding: 20px; border-radius: 12px; border: 2px solid #f0f0f0; }
        .reply-textarea { width: 100%; border: 2px solid #eee; border-radius: 12px; padding: 15px; resize: none; font-size: 14px; font-weight: 600; transition: all 0.3s; }
        .reply-textarea:focus { outline: none; border-color: var(--primary-orange); box-shadow: 0 0 8px rgba(255, 152, 0, 0.1); }
        .reply-submit-btn { background-color: var(--primary-orange); color: white; border: none; padding: 10px 24px; border-radius: 12px; font-weight: 800; cursor: pointer; float: right; margin-top: 12px; transition: transform 0.2s, background 0.2s; }
        .reply-submit-btn:hover { transform: scale(1.05); background-color: #e68a00; }
        .sidebar-card { background: #fff; border-radius: 16px; padding: 20px; margin-bottom: 24px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); border: 1px solid #eee; }
        .sidebar-card h4 { font-weight: 800; color: var(--deep-brown); margin-top: 0; margin-bottom: 15px; border-left: 4px solid var(--primary-orange); padding-left: 10px; }
        .sidebar-card ul { list-style: none; padding: 0; }
        .sidebar-card li a { text-decoration: none; color: #666; font-weight: 600; font-size: 0.95rem; display: block; padding: 6px 0; transition: color 0.2s; }
        .sidebar-card li a:hover { color: var(--primary-orange); }
		.transparent-popup { background: transparent !important; box-shadow: none !important; border: none !important; }
		.zoom-out-img { cursor: zoom-out; max-width: 95vw; max-height: 95vh; object-fit: contain; }
    </style>
</head>

<body>
    <div class="forum-header-mini">
        <div class="container" style="max-width: 1200px; margin: 0 auto; padding: 0 20px;">
            <h2 style="color: var(--deep-brown); margin: 0; font-weight: 900;">ğŸ¾ å¯µç‰©ç¤¾ç¾¤è²¼æ–‡</h2>
        </div>
    </div>

    <div class="main-container">
        <aside class="post-user-sidebar">
            <img src="https://via.placeholder.com/90" class="user-avatar" alt="User Avatar">
            <div class="user-name">åŸPOå¤§å¤§</div>
            <div style="font-size: 13px; color: #8d6e63; font-weight: 700;">LV.10 å¯µç‰©é”äºº</div>
        </aside>

        <main class="post-article-area">
            <div class="article-content-wrapper">
                <a th:href="@{/forumpost/get-forum-id-for-posts(forumId=${forumId}, forumName=${forumName})}" class="btn-back">
                    <i class="fas fa-arrow-left"></i> è¿”å› [[${forumName}]] åˆ—è¡¨
                </a>
                <h1 class="post-title" th:text="${forumPostVO.postTitle}"></h1>
                <div class="post-meta-top">
                    <span><i class="far fa-clock"></i> <span class="need-timeago" th:datetime="${forumPostVO.lastEditedAt}"></span></span>
                </div>
                <div class="post-img-box" th:if="${not #lists.isEmpty(picsId)}">
				    <th:block th:each="picId : ${picsId}">
				        <img th:src="@{/forum/get-pic-id-for-pic(picId=${picId})}" 
				             alt="è²¼æ–‡ç…§ç‰‡"
				             th:onclick="|openImageModal('@{/forum/get-pic-id-for-pic(picId=${picId})}')|"
				             class="zoomable-img">
				    </th:block>
				</div>
                <div class="post-main-text" th:text="${forumPostVO.postContent}"></div>
            </div>

            <section class="comment-section">
                <h4><i class="far fa-comments"></i> ç•™è¨€å›è¦†</h4>
                <th:block th:each="forumPostCommentVO : ${commentList}">
	                <div class="comment-item">
	                    <img src="https://via.placeholder.com/45" class="comment-user-mini-img">
	                    <div class="comment-body">
	                        <div>
	                            <span class="comment-user-name">æœƒå“¡åç¨±</span>
	                            <span class="need-timeago" th:datetime="${forumPostCommentVO.lastEditedAt}"></span>
	                        </div>
	                        <div th:text="${forumPostCommentVO.commentContent}" style="margin-top: 5px; font-weight: 600; color: #555;"></div>
	                    </div>
	                </div>
				</th:block>
				
                <div class="reply-box">
                    <form th:action="@{/forumpost/insert-comment}" th:object="${forumPostCommentVO}" method="post">
                        <input type="hidden" name="postId" th:value="${forumPostVO.postId}">
                        <input type="hidden" name="forumId" th:value="${forumId}">
                        <input type="hidden" name="forumName" th:value="${forumName}">
                        <textarea class="reply-textarea" th:field="*{commentContent}" rows="3" placeholder="è«‹ä¿æŒå‹å–„ç™¼è¨€ï¼Œåˆ†äº«æ‚¨çš„çœ‹æ³•..."></textarea>
                        <button type="submit" class="reply-submit-btn">ç•™è¨€</button>
                        <div style="clear:both;"></div>   

                        <div id="commentError"
                            th:if="${#fields.hasErrors('commentContent')}" 
                            th:data-error="${#fields.errors('commentContent')[0]}" 
                            style="display: none;">
                        </div>
                    </form>
                </div>
            </section>
        </main>
        <aside class="post-sidebar" style="width: 280px; flex-shrink: 0;">
            <div class="sidebar-card">
                <h4>ç¶²ç«™å…¬å‘Š</h4>
                <p style="font-size: 0.9rem; font-weight: 600; color: #777; line-height: 1.6;">è«‹ä¿æŒå‹å–„ç™¼è¨€ï¼Œåš´ç¦è¬¾ç½µæˆ–äººèº«æ”»æ“Šã€‚è®“æˆ‘å€‘ä¸€èµ·ç‡Ÿé€ æº«æš–ã€æœ‰æ„›çš„å¯µç‰©ç¤¾ç¾¤ã€‚</p>
            </div>
        </aside>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/timeago.js/4.0.2/timeago.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script th:src="@{/js/frontend/main.js}"></script>
    <script th:inline="javascript">
        // 1. åˆå§‹åŒ– timeago
        const nodes = document.querySelectorAll('.need-timeago');
        if (nodes.length) timeago.render(nodes, 'zh_TW');
        
        // 2. åœ–ç‰‡æ”¾å¤§ Modal
        function openImageModal(imgUrl) {
            Swal.fire({
                imageUrl: imgUrl,
                imageAlt: 'è²¼æ–‡ç…§ç‰‡',
                showConfirmButton: false,
                background: 'transparent',
                backdrop: 'rgba(0,0,0,0.8)',
                customClass: { popup: 'transparent-popup', image: 'zoom-out-img' },
                didOpen: () => { Swal.getPopup().addEventListener('click', () => Swal.close()); }
            });
        }
        
     	// 3. è™•ç†é©—è­‰éŒ¯èª¤å½ˆçª—
        document.addEventListener('DOMContentLoaded', function() {
            const errorEl = document.getElementById('commentError');
	        if (errorEl) {
	            const errorText = errorEl.getAttribute('data-error');
	            Swal.fire({
	                icon: 'warning',
	                title: 'ç•™è¨€å¤±æ•—',
	                text: errorText,
	                confirmButtonColor: '#ff9800'
	            });
	        }
        });
    </script>
</body>
</html>