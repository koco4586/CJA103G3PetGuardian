<!DOCTYPE html>
<html lang="zh-TW" xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>ä¿æ¯é ç´„ç´€éŒ„ | PetGuardian</title>
	<link rel="stylesheet" th:href="@{/css/frontend/style.css}">
	<link rel="stylesheet" th:href="@{/css/frontend/components.css}">
	<link rel="stylesheet" th:href="@{/css/frontend/dashboard.css}">
	<link rel="stylesheet" th:href="@{/css/frontend/booking/dashboard-bookings.css}">
	<link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;700&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
	<link rel="stylesheet" th:href="@{/css/frontend/evaluate-styles.css}">
	<style>
		/* åˆ†é æŒ‰éˆ•æ¨£å¼ */
		.pagination-container button {
			padding: 8px 16px;
			border: 1px solid #ddd;
			background: white;
			color: #333;
			border-radius: 8px;
			cursor: pointer;
			transition: all 0.2s;
			font-size: 0.9rem;
		}

		.pagination-container button:hover:not(:disabled) {
			background: #ffc107;
			color: white;
			border-color: #ffc107;
		}

		.pagination-container button.active {
			background: #ffc107;
			color: white;
			border-color: #ffc107;
			font-weight: bold;
		}

		.pagination-container button:disabled {
			background: #f5f5f5;
			color: #ccc;
			cursor: not-allowed;
		}

		/* æª¢èˆ‰è¼¸å…¥æ¡†æ¨£å¼ */
		.dynamic-report-wrapper {
			overflow: hidden;
			max-height: 0;
			opacity: 0;
			margin-top: 0;
			padding: 0 20px;
			transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
			background: #fff5f5;
			border-radius: 15px;
			border: 1px solid transparent;
			width: 100%;
			box-sizing: border-box;
		}

		.dynamic-report-wrapper.active {
			max-height: 800px;
			opacity: 1;
			margin-top: 15px;
			padding: 20px;
			border: 1px solid #ffcdd2;
			box-shadow: 0 4px 15px rgba(255, 205, 210, 0.3);
		}

		.report-tag {
			display: inline-block;
			padding: 6px 14px;
			margin: 5px;
			background: #fff;
			border: 1px solid #ffcdd2;
			border-radius: 20px;
			cursor: pointer;
			font-size: 0.9rem;
			color: #c62828;
			transition: all 0.2s;
		}

		.report-tag.selected {
			background: #ffcdd2;
			font-weight: bold;
		}

		.submit-report-btn {
			background: #ff6b6b;
			color: white;
			border: none;
			padding: 10px 25px;
			border-radius: 50px;
			cursor: pointer;
			font-weight: bold;
			display: flex;
			align-items: center;
			gap: 8px;
			float: right;
			transition: transform 0.1s, background 0.2s;
		}

		.submit-report-btn:active {
			transform: scale(0.92);
		}

		.submit-report-btn:hover {
			background: #ff5252;
		}
		.static-page-box {
			display: inline-flex;
			align-items: center;
			justify-content: center;
			height: 34px; 
			width: 65px; 
			border: 1px solid #e2e8f0; /* ç°è—è‰²é‚Šæ¡† */
			border-radius: 18px; /* åœ“è§’ */
			color: #64748b; /* ç°è—è‰²æ–‡å­— */
			font-size: 0.85rem; /* å­—é«”ç¨å¾®ç¸®å° */
			font-weight: 500;
			background-color: #f8fafc; /* æ¥µæ·ºåº•è‰² */
			margin: 0 5px;
			pointer-events: none;
			cursor: default;
			user-select: none; /* é˜²æ­¢æ–‡å­—è¢«è—è‰²é¸å– */
		}
		
	</style>

</head>

<body>
	<header id="main-header" class="header"></header>

	<div class="container dashboard-container">
		<!-- å´é‚Šæ¬„ -->
		<div th:replace="~{frontend/fragments/dashboard-sidebar :: sidebar(activePage='bookings')}"></div>

		<!-- ä¸»è¦å…§å®¹ -->
		<div class="main-content">
			<h2 class="mb-3" style="font-weight: 700;">æœƒå“¡é ç´„åˆ—è¡¨</h2>

			<div class="filter-tabs-container">
				<div class="filter-tabs-wrapper">
					<div class="filter-group">
						<a th:href="@{/booking/memberOrders}" class="tab-btn"
							th:classappend="${currentStatus == null} ? 'active' : ''">å…¨éƒ¨</a>

						<a th:href="@{/booking/memberOrders(status=0)}" class="tab-btn"
							th:classappend="${currentStatus != null && currentStatus == 0} ? 'active' : ''">å³å°‡åˆ°ä¾†</a>

						<a th:href="@{/booking/memberOrders(status=1)}" class="tab-btn"
							th:classappend="${currentStatus != null && currentStatus == 1} ? 'active' : ''">é€²è¡Œä¸­</a>

						<a th:href="@{/booking/memberOrders(status=2)}" class="tab-btn"
							th:classappend="${currentStatus != null && currentStatus == 2} ? 'active' : ''">æœå‹™å®Œæˆ</a>


						<a th:href="@{/booking/memberOrders(status=3)}" class="tab-btn"
							th:classappend="${currentStatus != null && currentStatus == 3} ? 'active' : ''">å·²å–æ¶ˆ</a>

						<!-- è©•åƒ¹æ¨™ç±¤ï¼šä¿æ¯æˆ–æœƒå“¡æœ¬äººå¯è¦‹ -->
						<a th:if="${session.roleId == 0 or session.memId == memId}" href="#" class="tab-btn"
							id="reviewsTab" onclick="event.preventDefault(); showMemberReviews();">è©•åƒ¹</a>
					</div>

					<a href="/booking/services" class="btn btn-primary btn-sm" style="border-radius: 2rem;">+ æ–°å¢é ç´„</a>
				</div>
			</div>

			<!-- å‹•æ…‹è³‡æ–™è¿´åœˆ -->
			<div class="booking-list">
				<div th:each="order : ${bookingList}" class="booking-card">
					<div class="d-flex align-center gap-lg">
						<div>
							<div class="d-flex align-center gap-sm mb-xs">
								<h4 th:text="${order.sitterName}">ä¿æ¯å§“å</h4>
								<span th:if="${order.orderStatus == 0}" class="badge-pill status-upcoming">å³å°‡åˆ°ä¾†</span>
								<span th:if="${order.orderStatus == 1}" class="badge-pill status-ongoing">é€²è¡Œä¸­</span>
								<span th:if="${order.orderStatus == 2}" class="badge-pill status-completed">æœå‹™å®Œæˆ</span>
								<span th:if="${order.orderStatus == 3}" class="badge-pill status-cancelled">å·²å–æ¶ˆ</span>
								<span th:if="${order.orderStatus == 4}" class="badge-pill status-cancelled">å·²é€€æ¬¾</span>
								<span th:if="${order.orderStatus == 5}" class="badge-pill status-completed">å·²çµæ¡ˆ</span>
								<span th:if="${order.orderStatus == 6}" class="badge-pill status-cancelled">å·²é€€æ¬¾</span>
							</div>
							<div th:if="${(order.orderStatus == 3 or order.orderStatus == 4 or order.orderStatus == 6) and order.cancelReason != null}" 
							     style="margin-top: 8px; padding: 8px 12px; background: #fff5f5; border-left: 3px solid #fa5252; border-radius: 4px; font-size: 0.85rem; color: #c92a2a;">
							    <i class="fas fa-info-circle"></i> <strong>å–æ¶ˆåŸå› ï¼š</strong>
							    <span th:text="${order.cancelReason}">ç†ç”±å…§å®¹</span>
							</div>
							<div style="color: #666; font-size: 0.9rem;">
								<i class="far fa-clock"></i> <span
									th:text="${#temporals.format(order.startTime, 'yyyy-MM-dd HH:mm')}"></span>
							</div>
						</div>
					</div>

					<div class="d-flex align-center gap-lg">
						<div class="text-right" style="min-width: 100px;">
							<div style="font-weight: 700; color: #ea580c; font-size: 1.2rem;"
								th:text="'$' + ${order.reservationFee}"></div>
							<div style="font-size: 0.75rem; color: #bbb;"
								th:text="'ID: #BK-' + ${order.bookingOrderId}"></div>
						</div>

						<div class="d-flex gap-sm">
							<th:block th:with="isPast=${order.startTime.isBefore(#temporals.createNow())}">
								<th:block th:if="${order.orderStatus == 0 or order.orderStatus == 1}">
									<form th:action="@{/chat/connect/booking}" method="post" style="display:inline;">
										<input type="hidden" name="targetUserId" th:value="${order.sitterMemId}" />
										<input type="hidden" name="chatroomType" value="0" />
										<button type="submit" class="btn btn-primary btn-sm">è¯çµ¡ä¿æ¯</button>
									</form>
								</th:block>
								<th:block th:if="${(order.orderStatus == 0 or order.orderStatus == 1) and !isPast}">
									<button type="button" th:data-id="${order.bookingOrderId}"
										th:data-start="${#temporals.format(order.startTime, 'yyyy-MM-dd HH:mm')}"
										onclick="openCancelModal(this)" class="btn btn-danger">
										å–æ¶ˆé ç´„</button>
								</th:block>

								<th:block
									th:if="${order.orderStatus == 2 or order.orderStatus == 5 or ((order.orderStatus == 0 or order.orderStatus == 1) and isPast)}">
									<!-- <button class="btn btn-outline btn-sm">æŸ¥çœ‹ç…§é¡§ç´€éŒ„</button> -->
									<!-- ğŸ”¥ é™åˆ¶ï¼šè¢«æª¢èˆ‰å…©æ¬¡å‰‡éš±è—ï¼Œä¸”å–®ç­†è¨‚å–®æœ€å¤šè©•åƒ¹ä¿æ¯å…©æ¬¡ï¼ˆé”æ¨™æ™‚æŒ‰éˆ•åç°ï¼‰ -->
									<button th:if="${order.complaintCount < 2}" class="btn btn-outline btn-sm"
										th:classappend="${order.memberEvalCount >= 2} ? 'btn-disabled-gray' : ''"
										th:onclick="${order.memberEvalCount < 2} ? |injectEvalBox(this, ${order.bookingOrderId}, ${order.sitterMemId})| : ''"
										th:title="${order.memberEvalCount >= 2} ? 'å–®ç­†è¨‚å–®è©•åƒ¹æ¬¡æ•¸å·²é”ä¸Šé™' : ''">è©•åƒ¹ä¿æ¯</button>
								</th:block>

								<th:block th:if="${order.orderStatus == 3}">
									<span style="color: #ccc; font-size: 0.9rem; margin-right: 1rem;">è¨‚å–®å·²çµæŸ</span>
								</th:block>
							</th:block>
						</div>
					</div>
				</div>

				<div th:if="${#lists.isEmpty(bookingList)}"
					style="text-align: center; padding: 5rem 0; background: white; border-radius: 2rem; border: 1px dashed #ddd;">
					<p style="color: #999;">ç›®å‰æ²’æœ‰é€²è¡Œä¸­çš„é ç´„</p>
				</div>
			</div>
		</div>
	</div>
	<div id="cancelBookingModal"
		style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); z-index: 9999; align-items: center; justify-content: center;">
		<div
			style="background: white; padding: 2rem; border-radius: 1rem; width: 90%; max-width: 450px; position: relative;">
			<button onclick="closeCancelModal()"
				style="position: absolute; right: 1.5rem; top: 1.5rem; background: none; border: none; font-size: 1.5rem; cursor: pointer;">&times;</button>
			<h3 class="mb-2">å–æ¶ˆé ç´„</h3>
			<div id="refundInfoBox" class="mb-3 p-3" style="background: #f8f9fa; border-radius: 8px;"></div>
			<div class="d-flex gap-md">
				<button class="btn btn-outline" style="flex: 1; border-radius: 2rem;"
					onclick="closeCancelModal()">æš«ä¸å–æ¶ˆ</button>
				<button class="btn btn-primary" id="confirmCancelBtn"
					style="flex: 1; background: #fa5252; border-color: #fa5252; border-radius: 2rem;">ç¢ºèªå–æ¶ˆä¸¦é€€æ¬¾</button>
			</div>
		</div>
	</div>
	<!-- åˆ†é æ§åˆ¶é … -->
	<div class="mt-5" th:if="${totalPages > 1}" 
     style="display: flex !important; justify-content: center !important; align-items: center !important; width: 100% !important; gap: 10px;">
    
    <a th:href="@{/booking/memberOrders(page=0, status=${currentStatus})}" 
       class="btn btn-outline btn-sm" th:if="${currentPage > 0}" style="border-radius: 20px;">ç¬¬ä¸€é </a>
    
    <a th:href="@{/booking/memberOrders(page=${currentPage - 1}, status=${currentStatus})}" 
       class="btn btn-outline btn-sm" th:if="${currentPage > 0}" style="border-radius: 20px;">
       <i class="fas fa-chevron-left"></i> ä¸Šä¸€é 
    </a>

    <span class="static-page-box" style="margin: 0;">
        <th:block th:text="${currentPage + 1}">1</th:block> / <th:block th:text="${totalPages}">2</th:block>
    </span>

    <a th:href="@{/booking/memberOrders(page=${currentPage + 1}, status=${currentStatus})}" 
       class="btn btn-outline btn-sm" th:if="${currentPage < totalPages - 1}" style="border-radius: 20px;">
       ä¸‹ä¸€é  <i class="fas fa-chevron-right"></i>
    </a>
    
    <a th:href="@{/booking/memberOrders(page=${totalPages - 1}, status=${currentStatus})}" 
       class="btn btn-outline btn-sm" th:if="${currentPage < totalPages - 1}" style="border-radius: 20px;">æœ€å¾Œä¸€é </a>
</div>
	<footer id="main-footer" style="background-color: #f9f9f9; margin-top: 4rem;"></footer>
	<script th:src="@{/js/frontend/main.js}"></script>
	<script th:src="@{/js/frontend/evaluate-functions.js}"></script>
	<script th:inline="javascript">
		/*<![CDATA[*/
		const contextPath = /*[[@{/}]]*/ '';
		/*]]>*/

		let currentCancelId = null;

		function openCancelModal(btn) {
			const orderId = btn.getAttribute('data-id');
			const startDateStr = btn.getAttribute('data-start');

			currentCancelId = orderId;
			const infoBox = document.getElementById('refundInfoBox');

			// è¨ˆç®—é€€è²»é‚è¼¯
			const now = new Date(); 
			const bookingDate = new Date(startDateStr);
			const diffMs = bookingDate - now;
			const diffHours = diffMs / (1000 * 60 * 60);

			if (diffHours >= 24) {
		        infoBox.innerHTML = `
		            <p style="color:#2f9e44; font-weight:600; margin:0;">ç¬¦åˆå…¨é¡é€€è²»æ¢ä»¶</p>
		            <p style="font-size:0.85rem; color:#666; margin:0.5rem 0 0 0;">é ç´„ç·¨è™Ÿï¼š#BK-${orderId}<br>è·é›¢æœå‹™é‚„æœ‰è¶…é 24 å°æ™‚ï¼Œå–æ¶ˆå°‡é€€é‚„ 100% é ç´„é‡‘ã€‚</p>`;
		    } else if (diffHours >= 12) {
		        infoBox.innerHTML = `
		            <p style="color:#ea580c; font-weight:600; margin:0;">é…Œæ”¶æ‰‹çºŒè²» (é€€é‚„ 50%)</p>
		            <p style="font-size:0.85rem; color:#666; margin:0.5rem 0 0 0;">é ç´„ç·¨è™Ÿï¼š#BK-${orderId}<br>è·é›¢æœå‹™åƒ…å‰© ${Math.floor(diffHours)} å°æ™‚ï¼Œå–æ¶ˆå°‡é€€é‚„ 50% é ç´„é‡‘ã€‚</p>`;
		    } else {
		        infoBox.innerHTML = `
		            <p style="color:#fa5252; font-weight:600; margin:0;">ç„¡æ³•é€€æ¬¾</p>
		            <p style="font-size:0.85rem; color:#666; margin:0.5rem 0 0 0;">é ç´„ç·¨è™Ÿï¼š#BK-${orderId}<br><strong style="color:#fa5252;">å› ç‚ºè·é›¢æœå‹™ä¸è¶³ 12 å°æ™‚ï¼Œæ‰€ä»¥ç„¡æ³•é€€æ¬¾ã€‚</strong><br>ä½†æ‚¨ä»å¯å–æ¶ˆé ç´„ä»¥é‡‹å‡ºä¿æ¯æ™‚æ®µã€‚</p>`;
		    }

			document.getElementById('cancelBookingModal').style.display = 'flex';

			// ç¶å®šæŒ‰éˆ•é»æ“Šäº‹ä»¶ (ç¢ºä¿åªç¶å®šä¸€æ¬¡)
			document.getElementById('confirmCancelBtn').onclick = function () {
				handleRefund(currentCancelId);
			};
		}

		function closeCancelModal() {
			document.getElementById('cancelBookingModal').style.display = 'none';
		}

		async function handleRefund(orderId) {
			let base = typeof contextPath !== 'undefined' ? contextPath : '';
		    if (base === '/') base = '';
			try {
				const response = await fetch(base + `/booking/refund/${orderId}`, {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' }
				});

				if (response.ok) {
					alert("å–æ¶ˆæˆåŠŸï¼ç³»çµ±å·²è‡ªå‹•è™•ç†é€€æ¬¾å¯©æ ¸ã€‚");
					window.location.reload();
				} else {
					const errorMsg = await response.text();
					alert("å–æ¶ˆå¤±æ•—ï¼š" + errorMsg); // é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
				}
			} catch (error) {
				console.error("Error:", error);
				alert("ç³»çµ±éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚");
			}
			closeCancelModal();
		}

		// é¡¯ç¤ºæœƒå“¡æ­·å²è©•åƒ¹
		async function showMemberReviews() {
			// å¾ Thymeleaf Model æˆ– Session å–å¾—åå­—ï¼Œè™•ç†å¼•è™Ÿèˆ‡ç©ºå€¼
			let memName = /*[[${memName}]]*/ '';
			if (!memName || memName === '""' || memName === "''") {
				memName = /*[[${session.memName}]]*/ 'æœƒå“¡';
			}
			if (!memName || memName === '""' || memName === "''") {
				memName = 'æœƒå“¡';
			}

			const memId = Number(/*[[${session.memId}]]*/) || 0;
			const reviewsTab = document.getElementById('reviewsTab');
			const bookingListContainer = document.querySelector('.booking-list');

			// ç§»é™¤æ‰€æœ‰æ¨™ç±¤çš„ active ç‹€æ…‹
			document.querySelectorAll('.tab-btn').forEach(tab => tab.classList.remove('active'));
			// è¨­å®šè©•åƒ¹æ¨™ç±¤ç‚º active
			reviewsTab.classList.add('active');

			try {
				let base = typeof contextPath !== 'undefined' ? contextPath : '';
				if (base === '/') base = '';
				const response = await fetch(base + `/pet/evaluate/member/${memId}`);
				let reviews = await response.json();

				// æª¢æŸ¥æ˜¯å¦è¿”å›éŒ¯èª¤å°è±¡ (ç”± Controller Map.of å›å‚³)
				if (reviews && reviews.error) {
					bookingListContainer.innerHTML = `<div class="alert alert-danger" style="margin: 2rem; border-radius: 1rem;">âš ï¸ è¼‰å…¥è©•åƒ¹å¤±æ•—: ${reviews.error}</div>`;
					return;
				}

				// ç¢ºä¿ reviews æ˜¯ä¸€å€‹æ•¸åˆ—ï¼Œé˜²æ­¢ calculateAvgRating å´©æ½°
				if (!Array.isArray(reviews)) {
					console.warn('API å›å‚³æ ¼å¼ä¸æ­£ç¢º:', reviews);
					reviews = [];
				}

				// æ¸…ç©ºè¨‚å–®åˆ—è¡¨å€åŸŸ
				bookingListContainer.innerHTML = '';

				// å»ºç«‹è©•åƒ¹é¡¯ç¤ºå€åŸŸï¼ˆå«æ”¶æ”¾åŠŸèƒ½ï¼‰
				const avg = calculateAvgRating(reviews);
				let reviewsHTML = `
					<div style="background: white; border-radius: 1.5rem; padding: 2rem; margin-bottom: 1.5rem;">
						<h3 style="cursor: pointer; user-select: none; margin-bottom: 1.5rem; color: #333;"
							onclick="toggleHistoryReviews('memberReviewsList', 'memberToggleIcon')">
							<i class="fas fa-comments"></i> ${memName} çš„è¢«è©•åƒ¹è¨˜éŒ„
							<span style="color: #999; font-size: 0.9rem; margin-left: 10px;">(å…± ${reviews.length} ç­†)</span>
							<i id="memberToggleIcon" class="fas fa-chevron-down" 
								style="float: right; transition: transform 0.3s;"></i>
							<span class="avg-rating" style="float: right; margin-right: 15px; color: #f39c12; font-weight: bold;">
								<i class="fas fa-star"></i> ${avg}
							</span>
						</h3>
						<div id="memberReviewsList" style="max-height: 0; overflow: hidden; transition: max-height 0.5s ease;">
							<div id="memberReviewsContainer" class="reviews-container"></div>
							<!-- åˆ†é æŒ‰éˆ• -->
							<div id="memberReviewsPagination" class="pagination-container" 
								style="text-align: center; margin-top: 1.5rem; display: flex; gap: 8px; justify-content: center; flex-wrap: wrap;"></div>
						</div>
					</div>
				`;

				bookingListContainer.innerHTML = reviewsHTML;

				// å¦‚æœæ²’æœ‰è©•åƒ¹
				if (reviews.length === 0) {
					document.getElementById('memberReviewsContainer').innerHTML = `
						<div style="text-align: center; padding: 3rem; color: #999;">
							<i class="far fa-comment-dots fa-3x" style="margin-bottom: 1rem; display: block;"></i>
							<p>ç›®å‰å°šç„¡è©•åƒ¹ç´€éŒ„</p>
						</div>
					`;
					// é è¨­å±•é–‹ï¼ˆæ²’æœ‰è©•åƒ¹æ™‚ï¼‰
					document.getElementById('memberReviewsList').style.maxHeight = '300px';
					return;
				}

				// ä½¿ç”¨åˆ†é åŠŸèƒ½ï¼ˆæ¯é  10 ç­†ï¼‰
				initPagination(
					reviews,
					10,
					'memberReviewsContainer',
					'memberReviewsPagination',
					function (review) {
						const stars = renderStars(review.starRating || 0);
						const reviewDate = new Date(review.createTime).toLocaleDateString('zh-TW');
						// ğŸ”¥ æª¢èˆ‰æŒ‰éˆ•é‚è¼¯ï¼šè‹¥ä¸æ˜¯æœ¬äººç™¼å‡ºçš„è©•åƒ¹ï¼Œæ‰é¡¯ç¤ºæª¢èˆ‰æŒ‰éˆ•
						const isOwnReview = memId > 0 && Number(review.senderMemId) === memId;
						const reportBtnHTML = !isOwnReview ? `
							<button class="btn btn-sm btn-outline-danger" 
								style="padding: 2px 8px; font-size: 0.8rem; margin-left: 10px;"
								onclick="reportReview(this, ${review.bookingOrderId}, ${review.evaluateId})">
								<i class="fas fa-flag"></i> æª¢èˆ‰
							</button>
						` : '';

						return `
							<div class="review-card" style="
								border: none;
								border-bottom: 1px solid #eee; 
								padding: 1.5rem 1.2rem; 
								margin-bottom: 0.5rem;
							">
								<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
									<div style="display: flex; align-items: center; gap: 10px;">
										<strong style="font-size: 1.1rem; color: #2c3e50;">${review.senderName}</strong>
										${reportBtnHTML}
									</div>
									<div style="color: #ffc107;">
										${stars}
									</div>
								</div>
								<p style="margin: 0.5rem 0; color: #666;">${review.content || ''}</p>
								<small style="color: #999;">${reviewDate}</small>
							</div>
						`;
					}
				);

				// é è¨­å±•é–‹
				setTimeout(() => {
					const container = document.getElementById('memberReviewsList');
					container.style.maxHeight = container.scrollHeight + 'px';
					document.getElementById('memberToggleIcon').style.transform = 'rotate(180deg)';
				}, 100);

			} catch (error) {
				console.error('è¼‰å…¥è©•åƒ¹å¤±æ•—:', error);
				alert('â— è¼‰å…¥è©•åƒ¹å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
			}
		}

		// è¨»ï¼šæª¢èˆ‰åŠŸèƒ½å·²æ”¹ç”¨ complaint-functions.js çš„ injectReportBox()

		// æ¸²æŸ“æ˜Ÿæ˜Ÿè©•åˆ†
		function renderStars(rating) {
			let stars = '';
			for (let i = 1; i <= 5; i++) {
				if (i <= rating) {
					stars += '<i class="fas fa-star"></i>';
				} else {
					stars += '<i class="far fa-star" style="color: #ddd;"></i>';
				}
			}
			return stars;
		}

	</script>

	<script th:src="@{/js/frontend/complaint-functions.js}"></script>

</body>

</html>