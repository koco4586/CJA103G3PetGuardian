<!DOCTYPE html>
<html lang="zh-TW" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¨è«–å€ | PetGuardian</title>
    <link rel="stylesheet" th:href="@{/css/frontend/style.css}">
    <link rel="stylesheet" th:href="@{/css/frontend/components.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .forum-header {
            background: linear-gradient(135deg, #fffcf5 0%, #faedcd 100%);
            padding: 3rem 0;
            margin-bottom: 2rem;
            border-bottom-left-radius: 24px;
            border-bottom-right-radius: 24px;
        }

        .post-card {
            display: flex;
            background: var(--white);
            padding: 1.5rem;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            margin-bottom: 1rem;
            border-left: 4px solid transparent;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .post-card:hover {
            transform: translateX(5px);
            border-left-color: var(--primary-color);
            box-shadow: var(--shadow-md);
        }

        .post-tag {
            background: #f1f3f5;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            color: #495057;
            margin-right: 0.5rem;
            font-weight: 500;
        }

        .btn-fav {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            color: #dee2e6;
            font-size: 1.25rem;
            cursor: pointer;
            transition: all 0.2s;
            z-index: 2;
        }

        .btn-fav:hover {
            color: #fa5252;
            transform: scale(1.1);
        }

        .btn-fav.active {
            color: #fa5252;
        }

        .search-bar-container {
            background: white;
            border-radius: 12px;
            padding: 1rem;
            box-shadow: var(--shadow-sm);
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            border: 2px solid #f1f3f5;
        }

        .search-input-wrapper {
            flex: 1;
            position: relative;
        }

        .search-input-wrapper i {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #adb5bd;
        }

        .search-input {
            width: 100%;
            padding: 0.8rem 1rem 0.8rem 2.8rem;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .search-input:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(212, 163, 115, 0.1);
        }

        .filter-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            overflow-x: auto;
            padding-bottom: 0.5rem;
        }

        .filter-tab {
            padding: 0.6rem 1.2rem;
            border-radius: 20px;
            border: 2px solid #e9ecef;
            background: white;
            cursor: pointer;
            white-space: nowrap;
            font-weight: 600;
            color: #495057;
            transition: all 0.2s;
        }

        .filter-tab:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .filter-tab.active {
            background: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: #adb5bd;
        }
    </style>
</head>

<body>

    <header id="main-header" class="header"></header>

    <div class="forum-header">
        <div class="container d-flex justify-between align-center">
            <div>
                <h1>ğŸ’¬ å¯µç‰©è¨è«–å€</h1>
                <p style="color: #555;">åˆ†äº«æ¯›å°å­©çš„æ—¥å¸¸ï¼Œäº¤æµé¤Šè‚²å¿ƒå¾—</p>
            </div>
            <button class="btn btn-primary"><i class="fas fa-pen"></i> ç™¼å¸ƒæ–°è©±é¡Œ</button>
        </div>
    </div>

    <div class="container d-flex gap-lg" style="flex-direction: row-reverse; min-height: 60vh;">

        <!-- Sidebar -->
        <div class="sidebar" style="flex: 0 0 250px; margin-left:20px;">
            <div class="card mb-2">
                <h4 class="mb-1">ç†±é–€è©±é¡Œ</h4>
                <ul style="font-size: 0.9rem;">
                    <li class="mb-1"><a href="#" style="color: #666;"># æ–°æ‰‹é¤Šç‹—æŒ‡å—</a></li>
                    <li class="mb-1"><a href="#" style="color: #666;"># è²“å’ªé£²é£Ÿç¦å¿Œ</a></li>
                    <li class="mb-1"><a href="#" style="color: #666;"># é€±æœ«å¥½å»è™•</a></li>
                </ul>
            </div>
            <div class="card">
                <h4 class="mb-1">ç‰ˆè¦å…¬å‘Š</h4>
                <p style="font-size: 0.9rem; color: #666;">
                    è«‹ä¿æŒå‹å–„ç™¼è¨€ï¼Œåš´ç¦è¬¾ç½µæˆ–äººèº«æ”»æ“Šã€‚
                </p>
            </div>
            <div class="card mt-2" id="search-stats" style="display: none;">
                <h4 class="mb-1">ç¯©é¸çµæœ</h4>
                <p style="font-size: 0.9rem; color: #666;" id="results-count"></p>
                <button class="btn btn-outline btn-sm mt-1" onclick="resetFilters()" style="width: 100%;">æ¸…é™¤ç¯©é¸</button>
            </div>
        </div>

        <!-- Post List Area -->
        <div style="flex: 1;">

            <!-- Search & Filter Controls -->
            <div class="search-bar-container">
                <div class="search-input-wrapper">
                    <i class="fas fa-search"></i>
                    <input type="text" class="search-input" id="postSearch" placeholder="æœå°‹æ–‡ç« æ¨™é¡Œæˆ–é—œéµå­—..."
                        onkeyup="handleSearch()">
                </div>
            </div>

            <div class="filter-tabs">
                <div class="filter-tab active" onclick="setCategory('all', this)" data-category="all">å…¨éƒ¨</div>
                <div class="filter-tab" onclick="setCategory('ğŸ¶ ç‹—ç‹—', this)" data-category="ğŸ¶ ç‹—ç‹—">ğŸ¶ ç‹—ç‹—</div>
                <div class="filter-tab" onclick="setCategory('ğŸ± è²“è²“', this)" data-category="ğŸ± è²“è²“">ğŸ± è²“è²“</div>
                <div class="filter-tab" onclick="setCategory('ğŸ¥ é†«ç™‚', this)" data-category="ğŸ¥ é†«ç™‚">ğŸ¥ é†«ç™‚</div>
                <div class="filter-tab" onclick="setCategory('ğŸ¥— é£²é£Ÿ', this)" data-category="ğŸ¥— é£²é£Ÿ">ğŸ¥— é£²é£Ÿ</div>
                <div class="filter-tab" onclick="setCategory('ğŸ–ï¸ å‡ºéŠ', this)" data-category="ğŸ–ï¸ å‡ºéŠ">ğŸ–ï¸ å‡ºéŠ</div>
            </div>

            <!-- Posts Container -->
            <div id="posts-container">
                <!-- Posts will be injected here -->
            </div>

        </div>
    </div>

    <footer id="main-footer" style="background-color: #f9f9f9; margin-top: 4rem;"></footer>

    <script th:src="@{/js/frontend/main.js}"></script>
    <script>
        // Article Data
        const articles = [
            {
                id: 1,
                author: 'æå°æ˜',
                avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Jack',
                time: '2å°æ™‚å‰',
                title: 'è«‹å•å¤§å®¶éƒ½çµ¦ç‹—ç‹—åƒä»€éº¼å“ç‰Œçš„é£¼æ–™ï¼Ÿ',
                content: 'å®¶è£¡çš„æŸ¯åŸºæœ€è¿‘æœ‰é»æŒ‘é£Ÿï¼Œæƒ³æ›å€‹å£å‘³è©¦è©¦çœ‹ï¼Œç›®å‰è€ƒæ…®...æœ‰æ²’æœ‰æ¨è–¦é®®é£Ÿæˆ–æ˜¯é«˜è©•åƒ¹çš„ä¹¾ç³§ï¼Ÿ',
                categories: ['ğŸ¥— é£²é£Ÿ', 'ğŸ¶ ç‹—ç‹—'],
                upvotes: 156,
                comments: 24,
                favorited: false
            },
            {
                id: 2,
                author: 'æ—æ²æ²',
                avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Coco',
                time: '5å°æ™‚å‰',
                title: 'åˆ†äº«å°åŒ—å¤§å®‰æ£®æ—å…¬åœ’é›ç‹—å¿ƒå¾—',
                content: 'é€±æœ«å¤©æ°£å¾ˆå¥½ï¼Œå¸¶ç‹—ç‹—å»å¤§å®‰æ£®æ—å…¬åœ’æ•£æ­¥ï¼Œé‡åˆ°å¾ˆå¤šå¯æ„›çš„æŸ´çŠ¬ï¼Œå¤§å®¶è¦æ³¨æ„ç‹—ç‹—çš„ç‰½ç¹©å–”ï¼',
                categories: ['ğŸ–ï¸ å‡ºéŠ', 'ğŸ¶ ç‹—ç‹—'],
                upvotes: 89,
                comments: 12,
                favorited: true
            },
            {
                id: 3,
                author: 'é™³å¤§å±±',
                avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Aneka',
                time: '1å¤©å‰',
                title: '[è«‹ç›Š] è€ç‹—é—œç¯€ä¿é¤Šå“æ¨è–¦',
                content: 'å®¶è£¡çš„é»ƒé‡‘çµçŠ¬å·²ç¶“10æ­²äº†ï¼Œæœ€è¿‘èµ°è·¯æœ‰é»åƒåŠ›ï¼Œæƒ³è«‹å•å¤§å®¶æœ‰æ²’æœ‰æ¨è–¦çš„è‘¡è„ç³–èƒºæˆ–æ˜¯é­šæ²¹ï¼Ÿ',
                categories: ['ğŸ¥ é†«ç™‚', 'ğŸ¶ ç‹—ç‹—'],
                upvotes: 10,
                comments: 5,
                favorited: false
            },
            {
                id: 4,
                author: 'ç‹å°ç¾',
                avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Mimi',
                time: '3å°æ™‚å‰',
                title: 'è²“å’ªä¸€ç›´æŠ“è€³æœµæ˜¯æ€éº¼äº†ï¼Ÿ',
                content: 'æˆ‘å®¶ä¸»å­æœ€è¿‘ä¸€ç›´ç˜‹ç‹‚æŠ“è€³æœµï¼Œé‚„æœ‰é»‘è‰²åˆ†æ³Œç‰©ï¼Œé€™æ˜¯è€³ç–¥èŸ²å—ï¼Ÿæ±‚åŠ©å¤§å®‰å€æ¨è–¦çš„ç¸é†«ï¼',
                categories: ['ğŸ¥ é†«ç™‚', 'ğŸ± è²“è²“'],
                upvotes: 45,
                comments: 18,
                favorited: false
            },
            {
                id: 5,
                author: 'å¼µå¤§ç‹',
                avatar: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Leo',
                time: '8å°æ™‚å‰',
                title: 'æ–°æ‰‹è²“å¥´å¿…å‚™ï¼šè‡ªå‹•è²“ç ‚ç›†å¿ƒå¾—',
                content: 'çµ‚æ–¼å…¥æ‰‹äº†å…¨è‡ªå‹•è²“ç ‚ç›†ï¼ŒçœŸçš„æ˜¯æ‡¶äººæ•‘æ˜Ÿï¼ä¸éæ›è²“ç ‚çš„æ™‚å€™é‚„æ˜¯è¦æ³¨æ„...é€™æ¬¾æ¨è–¦çµ¦é ç®—å……è¶³çš„æœ‹å‹ã€‚',
                categories: ['ğŸ± è²“è²“'],
                upvotes: 210,
                comments: 56,
                favorited: false
            }
        ];

        let currentCategory = 'all';
        let searchQuery = '';

        // Initial Render
        renderPosts();

        // Render Function
        function renderPosts() {
            const container = document.getElementById('posts-container');
            const filtered = articles.filter(post => {
                const matchesCategory = currentCategory === 'all' || post.categories.includes(currentCategory);
                const matchesSearch = post.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    post.content.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    post.author.toLowerCase().includes(searchQuery.toLowerCase());
                return matchesCategory && matchesSearch;
            });

            // Update stats sidebar
            if (currentCategory !== 'all' || searchQuery !== '') {
                document.getElementById('search-stats').style.display = 'block';
                document.getElementById('results-count').textContent = `æ‰¾åˆ° ${filtered.length} ç¯‡ç›¸é—œæ–‡ç« `;
            } else {
                document.getElementById('search-stats').style.display = 'none';
            }

            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-search mb-2" style="font-size: 3rem;"></i>
                        <h3>æ‰¾ä¸åˆ°ç›¸é—œæ–‡ç« </h3>
                        <p>æ›å€‹é—œéµå­—æœå°‹çœ‹çœ‹å§ï¼</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = filtered.map(post => `
                <div class="post-card" onclick="openPost(${post.id})">
                    <button class="btn-fav ${post.favorited ? 'active' : ''}" onclick="toggleFavorite(${post.id}, this); event.stopPropagation();">
                        <i class="${post.favorited ? 'fas' : 'far'} fa-heart"></i>
                    </button>
                    <div class="text-center" style="margin-right: 1.5rem; min-width: 50px;">
                        <i class="fas fa-chevron-up" style="color: ${post.upvotes > 20 ? 'var(--primary-color)' : '#ccc'};"></i>
                        <div style="font-weight: 700; font-size: 1.1rem;">${post.upvotes}</div>
                    </div>
                    <div style="flex:1;">
                        <div class="d-flex align-center text-light mb-1" style="font-size: 0.85rem;">
                            <img src="${post.avatar}" class="avatar" style="width: 24px; height: 24px; margin-right: 0.5rem; border-radius: 50%;">
                            <span style="font-weight:600;">${post.author}</span>
                            <span style="margin: 0 0.5rem;">â€¢</span>
                            <span>${post.time}</span>
                        </div>
                        <h3 class="mb-1">${post.title}</h3>
                        <p style="color: #666; margin-bottom: 0.8rem; line-height: 1.5;">
                            ${post.content}
                        </p>
                        <div class="d-flex align-center justify-between">
                            <div class="d-flex">
                                ${post.categories.map(cat => `<span class="post-tag">${cat}</span>`).join('')}
                            </div>
                            <div class="d-flex align-center" style="color: #adb5bd; font-size: 0.9rem;">
                                <i class="far fa-comment-alt" style="margin-right: 0.5rem;"></i> ${post.comments}
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Action Handlers
        function setCategory(category, element) {
            currentCategory = category;

            // Update UI tabs
            document.querySelectorAll('.filter-tab').forEach(tab => tab.classList.remove('active'));
            element.classList.add('active');

            renderPosts();
        }

        function handleSearch() {
            searchQuery = document.getElementById('postSearch').value;
            renderPosts();
        }

        function resetFilters() {
            currentCategory = 'all';
            searchQuery = '';
            document.getElementById('postSearch').value = '';

            document.querySelectorAll('.filter-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelector('[data-category="all"]').classList.add('active');

            renderPosts();
        }

        function toggleFavorite(id, btn) {
            const article = articles.find(a => a.id === id);
            if (article) {
                article.favorited = !article.favorited;
                const icon = btn.querySelector('i');

                if (article.favorited) {
                    btn.classList.add('active');
                    icon.classList.remove('far');
                    icon.classList.add('fas');
                    showToast('å·²åŠ å…¥æˆ‘çš„æ”¶è—');
                } else {
                    btn.classList.remove('active');
                    icon.classList.remove('fas');
                    icon.classList.add('far');
                    showToast('å·²å¾æ”¶è—ç§»é™¤');
                }
            }
        }

        function openPost(id) {
            // In real app: navigate to post detail page
            console.log('Opening post:', id);
            // alert('å°‡é€²å…¥æ–‡ç« è©³æƒ…é é¢ (ID: ' + id + ')');
        }

        // Helper toast (if not defined in main.js)
        function showToast(message) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                bottom: 2rem;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(0,0,0,0.8);
                color: white;
                padding: 0.8rem 1.5rem;
                border-radius: 50px;
                z-index: 9999;
                font-size: 0.9rem;
                animation: toastIn 0.3s ease, toastOut 0.3s ease 2s forwards;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => toast.remove(), 2500);
        }

        // Add toast animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes toastIn { from { bottom: 0; opacity: 0; } to { bottom: 2rem; opacity: 1; } }
            @keyframes toastOut { from { bottom: 2rem; opacity: 1; } to { bottom: 1rem; opacity: 0; } }
        `;
        document.head.appendChild(style);

    </script>
</body>

</html>