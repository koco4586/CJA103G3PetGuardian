<!doctype html>
<html lang="zh-Hant">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Pet Guardian - 保母管理系統</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <link rel="stylesheet" href="/css/backend/style.css">
    <link rel="stylesheet" href="/css/backend/sitters.css">
</head>

<body>
    <script src="/js/backend/sidebar.js"></script>

    <div class="main-content">
        <header>
            <button class="menu-btn" onclick="toggleSidebar()">☰</button>

            <img src="https://images.unsplash.com/photo-1518791841217-8f162f1e1131?q=80&w=60&auto=format&fit=crop"
                alt="logo" style="width:48px;height:48px;border-radius:10px;object-fit:cover;">

            <div>
                <h1>保母管理系統</h1>
                <div class="sub">審核申請、服務項目設定與帳號權限控管</div>
            </div>
        </header>

        <section>
            <div class="tab-container">
                <button class="tab-btn active" onclick="switchTab('audit')">
                    <i class="fa-solid fa-file-signature"></i> 文件/證明審核
                </button>
                <button class="tab-btn" onclick="switchTab('settings')">
                    <i class="fa-solid fa-sliders"></i> 服務與寵物設定
                </button>
                <button class="tab-btn" onclick="switchTab('access')">
                    <i class="fa-solid fa-user-slash"></i> 帳號停權控制
                </button>
            </div>

            <div id="panel-audit" class="panel active">
                <div class="card">
                    <h3>待審核申請列表</h3>
                    <div class="sub" style="margin-bottom:15px; color:#666;">
                        審核通過後，系統將自動建立保母帳號並發送 Email 通知申請人。
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>申請編號</th>
                                <th>會員ID</th>
                                <th>個人簡介</th>
                                <th>相關經驗</th>
                                <th>申請時間</th>
                                <th>狀態</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="app : ${applications}">
                                <td th:text="${app.appId}">1</td>
                                <td th:text="${app.memId}">101</td>
                                <td th:text="${#strings.abbreviate(app.appIntro, 50)}"
                                    style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                    我熱愛寵物，從小就和狗狗貓咪一起長大...
                                </td>
                                <td th:text="${#strings.abbreviate(app.appExperience, 50)}"
                                    style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                    曾照顧過3隻黃金獵犬和2隻波斯貓...
                                </td>
                                <td th:text="${#temporals.format(app.appCreatedAt, 'yyyy-MM-dd')}">2026-01-20</td>
                                <td>
                                    <span th:if="${app.appStatus == 0}"
                                        style="color:orange; font-weight:bold;">待審核</span>
                                    <span th:if="${app.appStatus == 1}"
                                        style="color:green; font-weight:bold;">已通過</span>
                                    <span th:if="${app.appStatus == 2}" style="color:red; font-weight:bold;">未通過</span>
                                </td>
                                <td>
                                    <!-- 只有待審核的申請才顯示審核按鈕 -->
                                    <div th:if="${app.appStatus == 0}">
                                        <form th:action="@{/admin/sitter/approve/{id}(id=${app.appId})}" method="post"
                                            style="display:inline;">
                                            <button type="submit" class="btn">通過並通知</button>
                                        </form>
                                        <form th:action="@{/admin/sitter/reject/{id}(id=${app.appId})}" method="post"
                                            style="display:inline;">
                                            <input type="text" name="reviewNote" placeholder="駁回原因" required
                                                style="width:120px; padding:0.3rem; margin-right:0.3rem;">
                                            <button type="submit" class="btn ghost"
                                                style="color:red; border-color:red;">駁回</button>
                                        </form>
                                    </div>
                                    <!-- 已審核的申請顯示狀態 -->
                                    <div th:if="${app.appStatus != 0}">
                                        <button class="btn ghost" disabled>已審核</button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div id="panel-settings" class="panel">
                <div style="display:grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap:20px;">

                    <div class="card">
                        <h3><i class="fa-solid fa-hand-holding-heart"></i> 服務項目設定</h3>
                        <div class="sub">設定平台上保母可提供的服務選項</div>

                        <div class="tag-container">
                            <span class="tag">到府照顧 <i class="fa-solid fa-xmark remove"></i></span>
                            <span class="tag">遛狗服務 <i class="fa-solid fa-xmark remove"></i></span>
                            <span class="tag">家庭寄宿 <i class="fa-solid fa-xmark remove"></i></span>
                            <span class="tag">洗澡美容 <i class="fa-solid fa-xmark remove"></i></span>
                        </div>

                        <div style="margin-top:16px; display:flex; gap:8px;">
                            <input type="text" placeholder="輸入新服務名稱..." style="width:70%;">
                            <button class="btn" style="width:30%;">新增</button>
                        </div>
                    </div>

                    <div class="card">
                        <h3><i class="fa-solid fa-paw"></i> 支援寵物種類</h3>
                        <div class="sub">設定系統支援的寵物類別</div>

                        <div class="tag-container">
                            <span class="tag">狗狗 (Dog) <i class="fa-solid fa-xmark remove"></i></span>
                            <span class="tag">貓咪 (Cat) <i class="fa-solid fa-xmark remove"></i></span>
                        </div>

                        <div style="margin-top:16px; display:flex; gap:8px;">
                            <input type="text" placeholder="輸入新種類..." style="width:70%;">
                            <button class="btn" style="width:30%;">新增</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="panel-access" class="panel">
                <div class="card">
                    <h3>保母名單與權限管理</h3>
                    <div class="sub" style="margin-bottom:15px; color:#666;">
                        針對違規保母進行暫時停權或永久封鎖。
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>保母編號</th>
                                <th>會員ID</th>
                                <th>保母姓名</th>
                                <th>服務地址</th>
                                <th>評價（平均星數）</th>
                                <th>目前狀態</th>
                                <th>註冊時間</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="sitter : ${sitters}">
                                <td th:text="${sitter.sitterId}">1</td>
                                <td th:text="${sitter.memId}">101</td>
                                <td th:text="${sitter.sitterName}">保母姓名</td>
                                <td th:text="${sitter.sitterAdd}">服務地址</td>
                                <td>
                                    <i class="fa-solid fa-star" style="color:gold"></i>
                                    <span
                                        th:text="${sitter.sitterRatingCount > 0 ? 
                                        T(java.lang.String).format('%.1f', sitter.sitterStarCount * 1.0 / sitter.sitterRatingCount) : '0.0'}">0.0</span>
                                    <span style="color:#666;">(<span
                                            th:text="${sitter.sitterRatingCount}">0</span>則)</span>
                                </td>
                                <td>
                                    <span th:if="${sitter.sitterStatus == 0}"
                                        style="color:green; font-weight:bold;">正常接案</span>
                                    <span th:if="${sitter.sitterStatus == 1}"
                                        style="color:red; font-weight:bold;">已停權</span>
                                </td>
                                <td th:text="${#temporals.format(sitter.sitterCreatedAt, 'yyyy-MM-dd')}">2026-01-20</td>
                                <td>
                                    <!-- 如果保母狀態是啟用(0)，顯示停權按鈕 -->
                                    <form th:if="${sitter.sitterStatus == 0}"
                                        th:action="@{/admin/sitter/suspend/{id}(id=${sitter.sitterId})}" method="post"
                                        style="display:inline;">
                                        <button type="submit" class="btn ghost"
                                            style="color:red; border-color:red;">停權</button>
                                    </form>
                                    <!-- 如果保母狀態是停權(1)，顯示恢復按鈕 -->
                                    <form th:if="${sitter.sitterStatus == 1}"
                                        th:action="@{/admin/sitter/restore/{id}(id=${sitter.sitterId})}" method="post"
                                        style="display:inline;">
                                        <button type="submit" class="btn" style="background:#4CAF50;">恢復權限</button>
                                    </form>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

        </section>
    </div>

    <script>
        function switchTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.panel').forEach(panel => panel.classList.remove('active'));

            event.currentTarget.classList.add('active');
            document.getElementById('panel-' + tabName).classList.add('active');
        }
    </script>
</body>

</html>