<!doctype html>
<html lang="zh-TW" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Pet Guardian - è©•åƒ¹ç®¡ç†</title>
    <link rel="stylesheet" th:href="@{https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css}" />
    <link rel="stylesheet" th:href="@{/css/backend/style.css}">
    <link rel="stylesheet" th:href="@{/css/backend/reviews.css}">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        /* é é¢å°ˆç”¨æ¨£å¼ - å…¶ä»–æ¨£å¼ç¹¼æ‰¿è‡ª style.css */
        textarea:focus {
            outline: none;
            border-color: var(--orange);
            box-shadow: 0 0 0 3px rgba(206, 135, 91, 0.1);
        }

        .form-group {
            margin-bottom: 20px;
        }
    </style>
   
</head>

<body>
    <script th:src="@{/js/backend/sidebar.js}"></script>

    <div class="main-content">
        <header>
            <button class="menu-btn" onclick="toggleSidebar()">â˜°</button>
            <img src="https://images.unsplash.com/photo-1518791841217-8f162f1e1131?q=80&w=60&auto=format&fit=crop"
                alt="logo" style="width:48px;height:48px;border-radius:10px;object-fit:cover;">
            <div>
                <h1>è©•åƒ¹æª¢èˆ‰ç®¡ç†</h1>
                <div class="sub">è™•ç†å…¨ç«™ï¼ˆä¿æ¯/å•†åŸï¼‰é•è¦è©•åƒ¹ç”³è¨´</div>
            </div>
        </header>

        <section>
            <div class="tab-container">
                <button class="tab-btn active" data-target="admin-section">
                    <i class="fa-solid fa-gavel"></i> å¾…å¯©æ ¸æª¢èˆ‰
                </button>
                
            </div>

			<div id="admin-section" class="card content-section">
			<div class="card">
			</div>
                <h3>æª¢èˆ‰å¯©æ ¸åˆ—è¡¨</h3>
                <table>
                    <thead>
                        <tr><th>ç”³è¨´ç·¨è™Ÿ</th>
<!--                 		<th>ç™¼èµ·æœƒå“¡</th> -->
                			<th>å…§å®¹</th>
                			<th>åŸå› </th>
                			<th>ç‹€æ…‹</th></tr>
                    </thead>
                    
                    <tbody>
                        
                        
                        <tr th:each="complaint : ${complaintList}">
                <td th:text="${complaint.bookingReportId}">1</td>
                <td th:text="${complaint.reportMemId}">1001</td>
                <td th:text="${complaint.reportReason}">å…§å®¹è¼‰å…¥ä¸­...</td>
                <td>
                    <span th:if="${complaint.reportStatus == 0}" style="color: orange;">å¾…è™•ç†</span>
                    <span th:if="${complaint.reportStatus == 1}" style="color: green;">ç”³è¨´é€šé</span>
                	<span th:if="${complaint.reportStatus == 2}" style="color: red; font-weight: bold;">ç”³è¨´é§å›</span>
                </td>
                <td>
    <button th:if="${complaint.reportStatus == 0}"
    		class="btn" 
            style="background: #3498db;" 
            th:onclick="'handleReview(' + ${complaint.bookingReportId} + ')'">
        è™•ç†
    </button>
    
    <span th:unless="${complaint.reportStatus == 0}" style="color: #888;">
            <i class="fa-solid fa-circle-check"></i> å·²çµæ¡ˆ
            </span>
</td>
            </tr>
            <tr th:if="${#lists.isEmpty(complaintList)}">
                <td colspan="5" style="text-align: center;">ç›®å‰æ²’æœ‰å¾…è™•ç†çš„ç”³è¨´</td>
            </tr>

                    </tbody>
                </table>
            </div>
            </section>
				</div>

            
                
                
               
                
           
        
    
    
    

<script type="text/javascript">







function handleReview(reportId) {
    // ç¬¬ä¸€æ­¥ï¼šç¢ºèªæ˜¯å¦é€²å…¥è™•ç†æµç¨‹
    Swal.fire({
        title: 'ç¢ºèªè™•ç†',
        text: `æ‚¨æ˜¯å¦è¦é–‹å§‹è™•ç†ç”³è¨´æ¡ˆè™Ÿï¼š#${reportId}ï¼Ÿ`,
        icon: 'question',
        showCancelButton: true,
        confirmButtonColor: '#3498db',
        cancelButtonColor: '#aaa',
        confirmButtonText: 'æ˜¯çš„ï¼Œé–‹å§‹å¯©æ ¸',
        cancelButtonText: 'å–æ¶ˆ'
    }).then((result) => {
        if (result.isConfirmed) {
            // ç¬¬äºŒæ­¥ï¼šå½ˆå‡ºå¯©æ ¸é¸é …
            openAuditModal(reportId);
        }
    });
}

function openAuditModal(reportId) {
    Swal.fire({
        title: 'å¯©æ ¸çµæœ',
        text: 'è«‹é¸æ“‡å°æ­¤ç”³è¨´æ¡ˆçš„è™•ç†æ–¹å¼ï¼š',
        icon: 'info',
        showDenyButton: true,
        showCancelButton: true,
        confirmButtonText: '<i class="fa-solid fa-check"></i> æ ¸å‡†ç”³è¨´',
        denyButtonText: '<i class="fa-solid fa-xmark"></i> é§å›ç”³è¨´',
        cancelButtonText: 'æš«æ™‚é—œé–‰',
        confirmButtonColor: '#27ae60', // ç¶ è‰² (æ ¸å‡†)
        denyButtonColor: '#e74c3c',    // ç´…è‰² (é§å›)
    }).then((result) => {
        let status = 0;
        let statusText = "";

        if (result.isConfirmed) {
            status = 1; // å‡è¨­ 1 æ˜¯æ ¸å‡†
            statusText = "å·²æ ¸å‡†";
        } else if (result.isDenied) {
            status = 2; // å‡è¨­ 2 æ˜¯é§å›
            statusText = "å·²é§å›";
        } else {
            return; // ä½¿ç”¨è€…æŒ‰å–æ¶ˆ
        }

        // ç¬¬ä¸‰æ­¥ï¼šç™¼é€ AJAX åˆ°å¾Œç«¯
        sendAuditResult(reportId, status, statusText);
    });
}

function sendAuditResult(reportId, status, statusText) {
    // ğŸš© é€™è£¡çš„åœ°å€å¿…é ˆæ˜¯ /admin (é¡åˆ¥è·¯å¾‘) + /pet/updateReportStatus (æ–¹æ³•è·¯å¾‘)
    fetch('/admin/pet/updateReportStatus', { 
        method: 'POST',
        headers: { 
            'Content-Type': 'application/x-www-form-urlencoded' 
        },
        body: new URLSearchParams({
            'reportId': reportId,
            'status': status
        })
    })
    .then(res => res.json()) // å› ç‚ºä½ çš„ Controller å›å‚³çš„æ˜¯ ResponseEntity.ok(Map)
    .then(data => {
        if (data.success) {
            Swal.fire({
                title: 'è™•ç†æˆåŠŸ',
                text: `æ¡ˆè™Ÿ #${reportId} å·²æ¨™è¨˜ç‚ºã€Œ${statusText}ã€`,
                icon: 'success',
                confirmButtonText: 'ç¢ºå®š'
            }).then(() => {
                location.reload(); // æˆåŠŸå¾Œåˆ·æ–°é é¢ï¼ŒThymeleaf æœƒæ ¹æ“šæ–°çš„ Status è®Šè‰²
            });
        } else {
            Swal.fire('éŒ¯èª¤', 'å¾Œå°æ›´æ–°å¤±æ•—', 'error');
        }
    })
    .catch(error => {
        console.error('Fetch error:', error);
        Swal.fire('éŒ¯èª¤', 'é€£ç·šç•°å¸¸ï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ–ä¼ºæœå™¨è·¯å¾‘', 'error');
    });
}

    



</script>

</body>

</html>